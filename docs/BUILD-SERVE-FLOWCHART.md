# ğŸ”„ Build vs Serve å¯è§†åŒ–æµç¨‹å›¾

## ğŸ“Š **æ•´ä½“æ¶æ„å›¾**

```mermaid
graph TD
    A[æºä»£ç  src/] --> B[npm run build]
    B --> C[dist/client/]
    B --> D[dist/server/]
    
    C --> E[é™æ€èµ„æº<br/>HTML, CSS, JS]
    D --> F[SSRæ¸²æŸ“å‡½æ•°<br/>entry-server.js]
    
    E --> G[npm run serve]
    F --> G
    
    G --> H[ExpressæœåŠ¡å™¨<br/>localhost:5173]
    
    H --> I[ç”¨æˆ·è¯·æ±‚]
    I --> J{SSRæ¸²æŸ“}
    J -->|æˆåŠŸ| K[æœåŠ¡ç«¯HTML]
    J -->|å¤±è´¥| L[å®¢æˆ·ç«¯HTML]
    
    K --> M[æµè§ˆå™¨æ¥æ”¶]
    L --> M
    M --> N[å®Œæ•´ç½‘é¡µ]
```

## â±ï¸ **æ—¶é—´çº¿å¯¹æ¯”**

### npm run build (ä¸€æ¬¡æ€§æ‰§è¡Œ)
```
æ—¶é—´è½´: 0s â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º 4.045s
       â”‚                    â”‚
       å¼€å§‹               æ„å»ºå®Œæˆ
       â”‚                    â”‚
       â””â”€ ç¼–è¯‘ä¸­ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”œâ”€ TypeScript â†’ JavaScript
         â”œâ”€ React â†’ æ¸²æŸ“å‡½æ•°  
         â”œâ”€ CSS â†’ å‹ç¼©æ ·å¼
         â””â”€ èµ„æº â†’ ä¼˜åŒ–æ‰“åŒ…
```

### npm run serve (æŒç»­è¿è¡Œ)
```
æ—¶é—´è½´: 0s â”€â”€â”€â”€â–º å¯åŠ¨ â”€â”€â”€â”€â–º âˆ (æŒç»­è¿è¡Œ)
       â”‚         â”‚          â”‚
       å¼€å§‹     æœåŠ¡å™¨      å¤„ç†è¯·æ±‚
       â”‚      å°±ç»ª 1s       â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º æ¯ä¸ªè¯·æ±‚ ~300ms
                           â”œâ”€ è·¯ç”±è§£æ
                           â”œâ”€ SSRå°è¯•  
                           â”œâ”€ HTMLç”Ÿæˆ
                           â””â”€ ç½‘ç»œä¼ è¾“
```

---

## ğŸ—ï¸ **æ„å»ºè¿‡ç¨‹è¯¦ç»†æµç¨‹**

```
æºæ–‡ä»¶                     æ„å»ºå·¥å…·                è¾“å‡ºæ–‡ä»¶
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ src/App.tsx â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ Vite Build  â”‚ â”€â”€â”€â”€â”€â”€â–º  â”‚ App-xxx.js  â”‚
â”‚ src/*.tsx   â”‚           â”‚ (TypeScript)â”‚          â”‚ (998KB)     â”‚
â”‚ src/*.css   â”‚           â”‚ (Rollup)    â”‚          â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ (esbuild)   â”‚          â”‚ index.css   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ (59KB)      â”‚
                                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚src/entry-   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ Vite SSR    â”‚ â”€â”€â”€â”€â”€â”€â–º  â”‚entry-server â”‚
â”‚server.tsx   â”‚           â”‚ Build       â”‚          â”‚.js (372KB)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ **æœåŠ¡å™¨è¿è¡Œæµç¨‹**

```
æœåŠ¡å™¨å¯åŠ¨                    è¯·æ±‚å¤„ç†                   å“åº”ç”Ÿæˆ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ server.js   â”‚             â”‚ æ¥æ”¶è¯·æ±‚    â”‚            â”‚ HTMLæ¨¡æ¿    â”‚
â”‚ è¯»å–é…ç½®    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ GET /       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ åŠ è½½å®Œæˆ    â”‚
â”‚ å¯åŠ¨Express â”‚             â”‚ POST /api   â”‚            â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                            â”‚                         â”‚
       â–¼                            â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¯¼å…¥SSRæ¨¡å— â”‚             â”‚ å°è¯•SSRæ¸²æŸ“ â”‚            â”‚ æ³¨å…¥å†…å®¹    â”‚
â”‚ entry-serverâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ render(url) â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ <div id=    â”‚
â”‚ .js         â”‚             â”‚             â”‚            â”‚ "root">HTML â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                            â”‚                         â”‚
       â–¼                            â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é™æ€èµ„æº    â”‚             â”‚ é”™è¯¯å¤„ç†    â”‚            â”‚ å‘é€å“åº”    â”‚
â”‚ dist/client â”‚             â”‚ å›é€€CSR     â”‚            â”‚ 200 OK      â”‚
â”‚ assets/     â”‚             â”‚             â”‚            â”‚ text/html   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ **æ–‡ä»¶ä¾èµ–å…³ç³»å›¾**

```
é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ src/                    (å¼€å‘æºç )
â”‚   â”œâ”€â”€ App.tsx            â”€â”€â”
â”‚   â”œâ”€â”€ entry-client.tsx   â”€â”€â”¼â”€â–º npm run build
â”‚   â”œâ”€â”€ entry-server.tsx   â”€â”€â”˜
â”‚   â””â”€â”€ components/
â”‚
â”œâ”€â”€ dist/                   (æ„å»ºäº§ç‰©)
â”‚   â”œâ”€â”€ client/            â—„â”€â”€â”€ build:client
â”‚   â”‚   â”œâ”€â”€ index.html     â”€â”€â”
â”‚   â”‚   â””â”€â”€ assets/        â”€â”€â”¼â”€â–º npm run serve
â”‚   â””â”€â”€ server/            â—„â”€â”˜  (è¯»å–è¿™äº›æ–‡ä»¶)
â”‚       â””â”€â”€ entry-server.js
â”‚
â”œâ”€â”€ server.js              â—„â”€â”€â”€ ç”Ÿäº§æœåŠ¡å™¨å…¥å£
â”œâ”€â”€ package.json           
â””â”€â”€ vite.config.ts         â—„â”€â”€â”€ æ„å»ºé…ç½®
```

---

## ğŸ”„ **æ•°æ®æµè½¬å›¾**

### æ„å»ºé˜¶æ®µæ•°æ®æµ
```
TypeScriptä»£ç  â†’ ç¼–è¯‘å™¨ â†’ JavaScriptä»£ç 
     â”‚              â”‚            â”‚
Reactç»„ä»¶    â†’ Babel  â†’ ES5å‡½æ•°
     â”‚              â”‚            â”‚  
CSSæ ·å¼     â†’ PostCSS â†’ å‹ç¼©CSS
     â”‚              â”‚            â”‚
å›¾ç‰‡èµ„æº    â†’ ä¼˜åŒ–å™¨  â†’ WebP/å‹ç¼©
     â”‚              â”‚            â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼
              æ‰“åŒ…åˆå¹¶ (Bundle)
                    â”‚
                    â–¼
            ç”Ÿæˆ dist/ æ–‡ä»¶å¤¹
```

### è¿è¡Œé˜¶æ®µæ•°æ®æµ
```
HTTPè¯·æ±‚ â†’ Expressè·¯ç”± â†’ server.jså¤„ç†
    â”‚           â”‚              â”‚
ç”¨æˆ·è®¿é—® â†’ è·¯å¾„è§£æ â†’ æŸ¥æ‰¾å¯¹åº”é¡µé¢
    â”‚           â”‚              â”‚
æµè§ˆå™¨   â†’ å‚æ•°è§£æ â†’ å‡†å¤‡æ¸²æŸ“æ•°æ®
    â”‚           â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â–¼
        SSRæ¸²æŸ“å¼•æ“ (React)
                â”‚
                â–¼
    â”Œâ”€ æˆåŠŸ â†’ å®Œæ•´HTML â”€â”
    â”‚                  â”‚
    â””â”€ å¤±è´¥ â†’ ç©ºHTML â”€â”€â”˜
                â”‚
                â–¼
        è¿”å›HTTPå“åº”
                â”‚
                â–¼
        æµè§ˆå™¨æ¥æ”¶å¹¶æ˜¾ç¤º
```

---

## ğŸ“Š **æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”**

### æ„å»ºæ€§èƒ½ (npm run build)
```
æŒ‡æ ‡              æ•°å€¼        å«ä¹‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»æ—¶é—´           4.045s      å®Œæ•´æ„å»ºå‘¨æœŸ
å®¢æˆ·ç«¯æ„å»º       3.000s      ä¸»è¦æ—¶é—´æ¶ˆè€—
æœåŠ¡ç«¯æ„å»º       0.409s      å¿«é€ŸSSRç¼–è¯‘
æ¨¡å—è½¬æ¢         2,464ä¸ª     å¤„ç†çš„æ–‡ä»¶æ•°
è¾“å‡ºå¤§å°         1.9MB       æœ€ç»ˆäº§ç‰©å¤§å°
CPUä½¿ç”¨ç‡        100%        ç¼–è¯‘æœŸé—´æ»¡è½½
å†…å­˜å³°å€¼         ~300MB      Node.js + ç¼–è¯‘å™¨
```

### æœåŠ¡å™¨æ€§èƒ½ (npm run serve)
```
æŒ‡æ ‡              æ•°å€¼        å«ä¹‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
å¯åŠ¨æ—¶é—´         <1s         Expresså¯åŠ¨
é¦–æ¬¡å“åº”         344ms       åŒ…å«SSRå°è¯•
é™æ€èµ„æº         <50ms       ç›´æ¥æ–‡ä»¶æœåŠ¡
å¹¶å‘è¯·æ±‚         >100/s      Expresså¤„ç†èƒ½åŠ›
å†…å­˜ä½¿ç”¨         ~50MB       è¿è¡Œæ—¶å ç”¨
CPUä½¿ç”¨ç‡        <10%        ç©ºé—²æ—¶æ¶ˆè€—
```

---

## ğŸ¯ **å…³é”®å·®å¼‚æ€»ç»“è¡¨**

| ç»´åº¦ | npm run build | npm run serve |
|------|---------------|---------------|
| **æ‰§è¡Œæ€§è´¨** | ä¸€æ¬¡æ€§ä»»åŠ¡ | æŒç»­è¿è¡ŒæœåŠ¡ |
| **ä¸»è¦ç›®çš„** | ç¼–è¯‘å’Œä¼˜åŒ–ä»£ç  | æä¾›HTTPæœåŠ¡ |
| **è¾“å…¥å†…å®¹** | æºä»£ç  (src/) | æ„å»ºäº§ç‰© (dist/) |
| **è¾“å‡ºç»“æœ** | é™æ€æ–‡ä»¶ | HTTPå“åº” |
| **æ—¶é—´ç‰¹æ€§** | 4ç§’å®Œæˆ | 24/7è¿è¡Œ |
| **èµ„æºå ç”¨** | é«˜CPUçŸ­æ—¶é—´ | ä½CPUé•¿æ—¶é—´ |
| **ç½‘ç»œç«¯å£** | æ—  | 5173ç«¯å£ç›‘å¬ |
| **ç”¨æˆ·äº¤äº’** | å¼€å‘è€…æ“ä½œ | ç»ˆç«¯ç”¨æˆ·è®¿é—® |
| **é”™è¯¯å½±å“** | æ„å»ºå¤±è´¥ | æœåŠ¡ä¸å¯ç”¨ |
| **ä¾èµ–å…³ç³»** | ç‹¬ç«‹æ‰§è¡Œ | ä¾èµ–buildäº§ç‰© |

---

## ğŸ† **æœ€ä½³å®è·µå·¥ä½œæµ**

### å¼€å‘é˜¶æ®µ
```bash
npm run dev:spa    # å¼€å‘æœåŠ¡å™¨ (çƒ­æ›´æ–°, å¿«é€Ÿè¿­ä»£)
    â†“
ä»£ç ä¿®æ”¹ â†’ è‡ªåŠ¨åˆ·æ–° â†’ ç«‹å³é¢„è§ˆ
```

### æµ‹è¯•é˜¶æ®µ  
```bash
npm run build      # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run serve      # æœ¬åœ°æµ‹è¯•ç”Ÿäº§ç¯å¢ƒ
    â†“
å‘ç°é—®é¢˜ â†’ ä¿®æ”¹ä»£ç  â†’ é‡æ–°æ„å»º â†’ å†æ¬¡æµ‹è¯•
```

### éƒ¨ç½²é˜¶æ®µ
```bash
npm run build      # CI/CDç¯å¢ƒæ„å»º
    â†“
dist/ æ–‡ä»¶å¤¹ â†’ éƒ¨ç½²åˆ°æœåŠ¡å™¨ â†’ npm run serve
```

### ç›‘æ§è¿ç»´
```bash
npm run serve      # ç”Ÿäº§æœåŠ¡å™¨
    â†“  
æ—¥å¿—ç›‘æ§ â†’ æ€§èƒ½åˆ†æ â†’ é”™è¯¯æŠ¥å‘Š â†’ ç‰ˆæœ¬æ›´æ–°
```

è¿™æ ·çš„æµç¨‹ç¡®ä¿äº†ä»å¼€å‘åˆ°ç”Ÿäº§çš„å®Œæ•´è´¨é‡ä¿è¯é“¾æ¡ï¼ ğŸš€