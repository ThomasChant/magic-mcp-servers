{
  "mcp_name": "Apache Doris",
  "mcp_description": "MCP Server For [Apache Doris](https://doris.apache.org/), an MPP-based real-time data warehouse.",
  "mcp_id": "apache_doris-mcp-server",
  "fetch_timestamp": "2025-06-23T01:11:54.082483Z",
  "github_url": "https://github.com/apache/doris-mcp-server",
  "repository": {
    "name": "doris-mcp-server",
    "full_name": "apache/doris-mcp-server",
    "description": "Apache doris",
    "html_url": "https://github.com/apache/doris-mcp-server",
    "created_at": "2025-05-06T03:21:08Z",
    "updated_at": "2025-06-20T10:44:27Z",
    "pushed_at": "2025-06-12T11:45:16Z",
    "size": 554,
    "stargazers_count": 91,
    "watchers_count": 91,
    "forks_count": 27,
    "open_issues_count": 1,
    "language": "Python",
    "license": "Apache License 2.0",
    "topics": [],
    "default_branch": "master",
    "owner": {
      "login": "apache",
      "type": "Organization",
      "avatar_url": "https://avatars.githubusercontent.com/u/47359?v=4",
      "html_url": "https://github.com/apache"
    },
    "has_issues": false,
    "has_projects": false,
    "has_downloads": true,
    "has_wiki": false,
    "has_pages": false,
    "archived": false,
    "disabled": false,
    "visibility": "public",
    "network_count": 27,
    "subscribers_count": 43,
    "languages": {
      "Python": 522777,
      "Shell": 3828,
      "Makefile": 3363,
      "Dockerfile": 1816
    },
    "language_percentages": {
      "Python": 98.31,
      "Shell": 0.72,
      "Makefile": 0.63,
      "Dockerfile": 0.34
    },
    "pull_requests_count": 2,
    "contributors_count": 3,
    "tags": [
      {
        "name": "0.3.0",
        "commit_sha": "82d2ef6f40d1e7268c1f89d23e5246b2bb49b8af"
      }
    ],
    "latest_version": "0.3.0"
  },
  "readme": "<!--\nLicensed to the Apache Software Foundation (ASF) under one\nor more contributor license agreements.  See the NOTICE file\ndistributed with this work for additional information\nregarding copyright ownership.  The ASF licenses this file\nto you under the Apache License, Version 2.0 (the\n\"License\"); you may not use this file except in compliance\nwith the License.  You may obtain a copy of the License at\n\n  http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing,\nsoftware distributed under the License is distributed on an\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\nKIND, either express or implied.  See the License for the\nspecific language governing permissions and limitations\nunder the License.\n-->\n\n# Doris MCP Server\n\nDoris MCP (Model Context Protocol) Server is a backend service built with Python and FastAPI. It implements the MCP, allowing clients to interact with it through defined \"Tools\". It's primarily designed to connect to Apache Doris databases, potentially leveraging Large Language Models (LLMs) for tasks like converting natural language queries to SQL (NL2SQL), executing queries, and performing metadata management and analysis.\n\n## 🚀 What's New in v0.4.0\n\n- **🛠️ Enhanced Monitoring Tools Module**: Advanced memory tracking, metrics collection, and BE node discovery with modular, extensible design\n- **🔍 Mature Query Information Tools**: Enhanced SQL explain and profiling with configurable content truncation, file export for LLM attachments, and advanced query analytics\n- **⚙️ Unified Configuration Framework**: Centralized configuration management through `config.py` with comprehensive validation and standardized parameter naming\n- **🗃️ Smart Default Database Handling**: Automatic fallback to `information_schema` database, eliminating startup configuration requirements and improving reliability\n- **🗑️ Production-Ready Architecture**: Removed experimental tools in favor of battle-tested, production-ready alternatives with better performance and monitoring\n\n> **⚠️ Breaking Changes**: Experimental tools (`column_analysis`, `performance_stats`) have been removed and replaced with enhanced monitoring and query information tools.\n\n## Core Features\n\n*   **MCP Protocol Implementation**: Provides standard MCP interfaces, supporting tool calls, resource management, and prompt interactions.\n*   **Streamable HTTP Communication**: Unified HTTP endpoint supporting both request/response and streaming communication for optimal performance and reliability.\n*   **Stdio Communication**: Standard input/output mode for direct integration with MCP clients like Cursor.\n*   **Enterprise-Grade Architecture**: Modular design with comprehensive functionality:\n    *   **Tools Manager**: Centralized tool registration and routing with unified interfaces (`doris_mcp_server/tools/tools_manager.py`)\n    *   **Enhanced Monitoring Tools Module**: Advanced memory tracking, metrics collection, and flexible BE node discovery (Enhanced in v0.4.0)\n    *   **Query Information Tools**: Enhanced SQL explain and profiling with configurable content management and LLM file export capabilities (Enhanced in v0.4.0)\n    *   **Resources Manager**: Resource management and metadata exposure (`doris_mcp_server/tools/resources_manager.py`)\n    *   **Prompts Manager**: Intelligent prompt templates for data analysis (`doris_mcp_server/tools/prompts_manager.py`)\n*   **Advanced Database Features**:\n    *   **Query Execution**: High-performance SQL execution with advanced caching and optimization (`doris_mcp_server/utils/query_executor.py`)\n    *   **Security Management**: Comprehensive SQL security validation, data masking, and access control (`doris_mcp_server/utils/security.py`)\n    *   **Metadata Extraction**: Comprehensive database metadata with catalog federation support (`doris_mcp_server/utils/schema_extractor.py`)\n    *   **Performance Analysis**: Advanced column analysis, performance monitoring, and data analysis tools (`doris_mcp_server/utils/analysis_tools.py`)\n*   **Catalog Federation Support**: Full support for multi-catalog environments (internal Doris tables and external data sources like Hive, MySQL, etc.)\n*   **Enterprise Security**: Comprehensive security framework with authentication, authorization, SQL injection protection, and data masking capabilities (`doris_mcp_server/utils/security.py`)\n*   **Flexible Configuration**: Comprehensive configuration management with environment variables, file-based config, and validation (`doris_mcp_server/utils/config.py`)\n\n## System Requirements\n\n*   Python 3.12+\n*   Database connection details (e.g., Doris Host, Port, User, Password, Database)\n\n## 🚀 Quick Start\n\n### Installation from PyPI\n\n```bash\n# Install the latest version\npip install mcp-doris-server\n\n# Install specific version\npip install mcp-doris-server==0.4.0\n```\n\n> **💡 Command Compatibility**: After installation, both `doris-mcp-server` and `mcp-doris-server` commands are available for backward compatibility. You can use either command interchangeably.\n\n### Start Streamable HTTP Mode (Web Service)\n\nThe primary communication mode offering optimal performance and reliability:\n\n```bash\n# Full configuration with database connection\ndoris-mcp-server \\\n    --transport http \\\n    --host 0.0.0.0 \\\n    --port 3000 \\\n    --db-host 127.0.0.1 \\\n    --db-port 9030 \\\n    --db-user root \\\n    --db-password your_password \n```\n\n### Start Stdio Mode (for Cursor and other MCP clients)\n\nStandard input/output mode for direct integration with MCP clients:\n\n```bash\n# For direct integration with MCP clients like Cursor\ndoris-mcp-server --transport stdio\n```\n\n### Verify Installation\n\n```bash\n# Check installation\ndoris-mcp-server --help\n\n# Test HTTP mode (in another terminal)\ncurl http://localhost:3000/health\n```\n\n### Environment Variables (Optional)\n\nInstead of command-line arguments, you can use environment variables:\n\n```bash\nexport DORIS_HOST=\"127.0.0.1\"\nexport DORIS_PORT=\"9030\"\nexport DORIS_USER=\"root\"\nexport DORIS_PASSWORD=\"your_password\"\n\n# Then start with simplified command\ndoris-mcp-server --transport http --host 0.0.0.0 --port 3000\n```\n\n### Command Line Arguments\n\nThe `doris-mcp-server` command supports the following arguments:\n\n| Argument | Description | Default | Required |\n|:---------|:------------|:--------|:---------|\n| `--transport` | Transport mode: `http` or `stdio` | `http` | No |\n| `--host` | HTTP server host (HTTP mode only) | `0.0.0.0` | No |\n| `--port` | HTTP server port (HTTP mode only) | `3000` | No |\n| `--db-host` | Doris database host | `localhost` | No |\n| `--db-port` | Doris database port | `9030` | No |\n| `--db-user` | Doris database username | `root` | No |\n| `--db-password` | Doris database password | - | Yes (unless in env) |\n\n## Development Setup\n\nFor developers who want to build from source:\n\n### 1. Clone the Repository\n\n```bash\n# Replace with the actual repository URL if different\ngit clone https://github.com/apache/doris-mcp-server.git\ncd doris-mcp-server\n```\n\n### 2. Install Dependencies\n\n```bash\npip install -r requirements.txt\n```\n\n### 3. Configure Environment Variables\n\nCopy the `.env.example` file to `.env` and modify the settings according to your environment:\n\n```bash\ncp .env.example .env\n```\n\n**Key Environment Variables:**\n\n*   **Database Connection**:\n    *   `DORIS_HOST`: Database hostname (default: localhost)\n    *   `DORIS_PORT`: Database port (default: 9030)\n    *   `DORIS_USER`: Database username (default: root)\n    *   `DORIS_PASSWORD`: Database password\n    *   `DORIS_DATABASE`: Default database name (default: information_schema)\n    *   `DORIS_MIN_CONNECTIONS`: Minimum connection pool size (default: 5)\n    *   `DORIS_MAX_CONNECTIONS`: Maximum connection pool size (default: 20)\n    *   `DORIS_BE_HOSTS`: BE nodes for monitoring (comma-separated, optional - auto-discovery via SHOW BACKENDS if empty)\n    *   `DORIS_BE_WEBSERVER_PORT`: BE webserver port for monitoring tools (default: 8040)\n*   **Security Configuration**:\n    *   `AUTH_TYPE`: Authentication type (token/basic/oauth, default: token)\n    *   `TOKEN_SECRET`: Token secret key\n    *   `ENABLE_MASKING`: Enable data masking (default: true)\n    *   `MAX_RESULT_ROWS`: Maximum result rows (default: 10000)\n*   **Performance Configuration**:\n    *   `ENABLE_QUERY_CACHE`: Enable query caching (default: true)\n    *   `CACHE_TTL`: Cache time-to-live in seconds (default: 300)\n    *   `MAX_CONCURRENT_QUERIES`: Maximum concurrent queries (default: 50)\n    *   `MAX_RESPONSE_CONTENT_SIZE`: Maximum response content size for LLM compatibility (default: 4096, New in v0.4.0)\n*   **Logging Configuration**:\n    *   `LOG_LEVEL`: Log level (DEBUG/INFO/WARNING/ERROR, default: INFO)\n    *   `LOG_FILE_PATH`: Log file path\n    *   `ENABLE_AUDIT`: Enable audit logging (default: true)\n\n### Available MCP Tools\n\nThe following table lists the main tools currently available for invocation via an MCP client:\n\n| Tool Name                   | Description                                                  | Parameters                                                   |\n|-----------------------------|--------------------------------------------------------------|--------------------------------------------------------------|\n| `exec_query`                | Execute SQL query and return results.                       | `sql` (string, Required), `db_name` (string, Optional), `catalog_name` (string, Optional), `max_rows` (integer, Optional), `timeout` (integer, Optional) |\n| `get_table_schema`          | Get detailed table structure information.                   | `table_name` (string, Required), `db_name` (string, Optional), `catalog_name` (string, Optional) |\n| `get_db_table_list`         | Get list of all table names in specified database.         | `db_name` (string, Optional), `catalog_name` (string, Optional) |\n| `get_db_list`               | Get list of all database names.                             | `catalog_name` (string, Optional)                           |\n| `get_table_comment`         | Get table comment information.                              | `table_name` (string, Required), `db_name` (string, Optional), `catalog_name` (string, Optional) |\n| `get_table_column_comments` | Get comment information for all columns in table.          | `table_name` (string, Required), `db_name` (string, Optional), `catalog_name` (string, Optional) |\n| `get_table_indexes`         | Get index information for specified table.                  | `table_name` (string, Required), `db_name` (string, Optional), `catalog_name` (string, Optional) |\n| `get_recent_audit_logs`     | Get audit log records for recent period.                    | `days` (integer, Optional), `limit` (integer, Optional)     |\n| `get_catalog_list`          | Get list of all catalog names.                              | `random_string` (string, Required)                          |\n| `get_sql_explain`           | Get SQL execution plan with configurable content truncation and file export for LLM analysis.               | `sql` (string, Required), `verbose` (boolean, Optional), `db_name` (string, Optional), `catalog_name` (string, Optional) |\n| `get_sql_profile`           | Get SQL execution profile with content management and file export for LLM optimization workflows.                  | `sql` (string, Required), `db_name` (string, Optional), `catalog_name` (string, Optional), `timeout` (integer, Optional) |\n| `get_table_data_size`       | Get table data size information via FE HTTP API.           | `db_name` (string, Optional), `table_name` (string, Optional), `single_replica` (boolean, Optional) |\n| `get_monitoring_metrics_info` | Get Doris monitoring metrics definitions and descriptions. | `role` (string, Optional), `monitor_type` (string, Optional), `priority` (string, Optional) |\n| `get_monitoring_metrics_data` | Get actual Doris monitoring metrics data from nodes with flexible BE discovery.      | `role` (string, Optional), `monitor_type` (string, Optional), `priority` (string, Optional) |\n| `get_realtime_memory_stats` | Get real-time memory statistics via BE Memory Tracker with auto/manual BE discovery.     | `tracker_type` (string, Optional), `include_details` (boolean, Optional) |\n| `get_historical_memory_stats` | Get historical memory statistics via BE Bvar interface with flexible BE configuration.   | `tracker_names` (array, Optional), `time_range` (string, Optional) |\n\n**Note:** All metadata tools support catalog federation for multi-catalog environments. The `get_catalog_list` tool requires a `random_string` parameter for compatibility reasons. Enhanced monitoring tools in v0.4.0 provide comprehensive memory tracking and metrics collection capabilities with flexible BE node discovery.\n\n### 4. Run the Service\n\nExecute the following command to start the server:\n\n```bash\n./start_server.sh\n```\n\nThis command starts the FastAPI application with Streamable HTTP MCP service.\n\n**Service Endpoints:**\n\n*   **Streamable HTTP**: `http://<host>:<port>/mcp` (Primary MCP endpoint - supports GET, POST, DELETE, OPTIONS)\n*   **Health Check**: `http://<host>:<port>/health`\n*   **Status Check**: `http://<host>:<port>/status`\n\n> **Note**: The server uses Streamable HTTP for web-based communication, providing unified request/response and streaming capabilities.\n\n## Usage\n\nInteraction with the Doris MCP Server requires an **MCP Client**. The client connects to the server's Streamable HTTP endpoint and sends requests according to the MCP specification to invoke the server's tools.\n\n**Main Interaction Flow:**\n\n1.  **Client Initialization**: Send an `initialize` method call to `/mcp` (Streamable HTTP).\n2.  **(Optional) Discover Tools**: The client can call `tools/list` to get the list of supported tools, their descriptions, and parameter schemas.\n3.  **Call Tool**: The client sends a `tools/call` request, specifying the `name` and `arguments`.\n    *   **Example: Get Table Schema**\n        *   `name`: `get_table_schema`\n        *   `arguments`: Include `table_name`, `db_name`, `catalog_name`.\n4.  **Handle Response**:\n    *   **Non-streaming**: The client receives a response containing `content` or `isError`.\n    *   **Streaming**: The client receives a series of progress notifications, followed by a final response.\n\n### Catalog Federation Support\n\nThe Doris MCP Server supports **catalog federation**, enabling interaction with multiple data catalogs (internal Doris tables and external data sources like Hive, MySQL, etc.) within a unified interface.\n\n#### Key Features:\n\n*   **Multi-Catalog Metadata Access**: All metadata tools (`get_db_list`, `get_db_table_list`, `get_table_schema`, etc.) support an optional `catalog_name` parameter to query specific catalogs.\n*   **Cross-Catalog SQL Queries**: Execute SQL queries that span multiple catalogs using three-part table naming.\n*   **Catalog Discovery**: Use `mcp_doris_get_catalog_list` to discover available catalogs and their types.\n\n#### Three-Part Naming Requirement:\n\n**All SQL queries MUST use three-part naming for table references:**\n\n*   **Internal Tables**: `internal.database_name.table_name`\n*   **External Tables**: `catalog_name.database_name.table_name`\n\n#### Examples:\n\n1.  **Get Available Catalogs:**\n    ```json\n    {\n      \"tool_name\": \"mcp_doris_get_catalog_list\",\n      \"arguments\": {\"random_string\": \"unique_id\"}\n    }\n    ```\n\n2.  **Get Databases in Specific Catalog:**\n    ```json\n    {\n      \"tool_name\": \"mcp_doris_get_db_list\", \n      \"arguments\": {\"random_string\": \"unique_id\", \"catalog_name\": \"mysql\"}\n    }\n    ```\n\n3.  **Query Internal Catalog:**\n    ```json\n    {\n      \"tool_name\": \"mcp_doris_exec_query\",\n      \"arguments\": {\n        \"random_string\": \"unique_id\",\n        \"sql\": \"SELECT COUNT(*) FROM internal.ssb.customer\"\n      }\n    }\n    ```\n\n4.  **Query External Catalog:**\n    ```json\n    {\n      \"tool_name\": \"mcp_doris_exec_query\", \n      \"arguments\": {\n        \"random_string\": \"unique_id\",\n        \"sql\": \"SELECT COUNT(*) FROM mysql.ssb.customer\"\n      }\n    }\n    ```\n\n5.  **Cross-Catalog Query:**\n    ```json\n    {\n      \"tool_name\": \"mcp_doris_exec_query\",\n      \"arguments\": {\n        \"random_string\": \"unique_id\", \n        \"sql\": \"SELECT i.c_name, m.external_data FROM internal.ssb.customer i JOIN mysql.test.user_info m ON i.c_custkey = m.customer_id\"\n      }\n    }\n    ```\n\n## Security Configuration\n\nThe Doris MCP Server includes a comprehensive security framework that provides enterprise-level protection through authentication, authorization, SQL security validation, and data masking capabilities.\n\n### Security Features\n\n*   **🔐 Authentication**: Support for token-based and basic authentication\n*   **🛡️ Authorization**: Role-based access control (RBAC) with security levels\n*   **🚫 SQL Security**: SQL injection protection and blocked operations\n*   **🎭 Data Masking**: Automatic sensitive data masking based on user permissions\n*   **📊 Security Levels**: Four-tier security classification (Public, Internal, Confidential, Secret)\n\n### Authentication Configuration\n\nConfigure authentication in your environment variables:\n\n```bash\n# Authentication Type (token/basic/oauth)\nAUTH_TYPE=token\n\n# Token Secret for JWT validation\nTOKEN_SECRET=your_secret_key_here\n\n# Session timeout (in seconds)\nSESSION_TIMEOUT=3600\n```\n\n#### Token Authentication Example\n\n```python\n# Client authentication with token\nauth_info = {\n    \"type\": \"token\",\n    \"token\": \"your_jwt_token\",\n    \"session_id\": \"unique_session_id\"\n}\n```\n\n#### Basic Authentication Example\n\n```python\n# Client authentication with username/password\nauth_info = {\n    \"type\": \"basic\",\n    \"username\": \"analyst\",\n    \"password\": \"secure_password\",\n    \"session_id\": \"unique_session_id\"\n}\n```\n\n### Authorization & Security Levels\n\nThe system supports four security levels with hierarchical access control:\n\n| Security Level | Access Scope | Typical Use Cases |\n|:---------------|:-------------|:------------------|\n| **Public** | Unrestricted access | Public reports, general statistics |\n| **Internal** | Company employees | Internal dashboards, business metrics |\n| **Confidential** | Authorized personnel | Customer data, financial reports |\n| **Secret** | Senior management | Strategic data, sensitive analytics |\n\n#### Role Configuration\n\nConfigure user roles and permissions:\n\n```python\n# Example role configuration\nrole_permissions = {\n    \"data_analyst\": {\n        \"security_level\": \"internal\",\n        \"permissions\": [\"read_data\", \"execute_query\"],\n        \"allowed_tables\": [\"sales\", \"products\", \"orders\"]\n    },\n    \"data_admin\": {\n        \"security_level\": \"confidential\", \n        \"permissions\": [\"read_data\", \"execute_query\", \"admin\"],\n        \"allowed_tables\": [\"*\"]\n    },\n    \"executive\": {\n        \"security_level\": \"secret\",\n        \"permissions\": [\"read_data\", \"execute_query\", \"admin\"],\n        \"allowed_tables\": [\"*\"]\n    }\n}\n```\n\n### SQL Security Validation\n\nThe system automatically validates SQL queries for security risks:\n\n#### Blocked Operations\n\nConfigure blocked SQL operations:\n\n```bash\n# Environment variable\nBLOCKED_SQL_OPERATIONS=DROP,DELETE,TRUNCATE,ALTER,CREATE,INSERT,UPDATE,GRANT,REVOKE\n\n# Maximum query complexity score\nMAX_QUERY_COMPLEXITY=100\n```\n\n#### SQL Injection Protection\n\nThe system automatically detects and blocks:\n\n*   **Union-based injections**: `UNION SELECT` attacks\n*   **Boolean-based injections**: `OR 1=1` patterns  \n*   **Time-based injections**: `SLEEP()`, `WAITFOR` functions\n*   **Comment injections**: `--`, `/**/` patterns\n*   **Stacked queries**: Multiple statements separated by `;`\n\n#### Example Security Validation\n\n```python\n# This query would be blocked\ndangerous_sql = \"SELECT * FROM users WHERE id = 1; DROP TABLE users;\"\n\n# This query would be allowed\nsafe_sql = \"SELECT name, email FROM users WHERE department = 'sales'\"\n```\n\n### Data Masking Configuration\n\nConfigure automatic data masking for sensitive information:\n\n#### Built-in Masking Rules\n\n```python\n# Default masking rules\nmasking_rules = [\n    {\n        \"column_pattern\": r\".*phone.*|.*mobile.*\",\n        \"algorithm\": \"phone_mask\",\n        \"parameters\": {\n            \"mask_char\": \"*\",\n            \"keep_prefix\": 3,\n            \"keep_suffix\": 4\n        },\n        \"security_level\": \"internal\"\n    },\n    {\n        \"column_pattern\": r\".*email.*\", \n        \"algorithm\": \"email_mask\",\n        \"parameters\": {\"mask_char\": \"*\"},\n        \"security_level\": \"internal\"\n    },\n    {\n        \"column_pattern\": r\".*id_card.*|.*identity.*\",\n        \"algorithm\": \"id_mask\", \n        \"parameters\": {\n            \"mask_char\": \"*\",\n            \"keep_prefix\": 6,\n            \"keep_suffix\": 4\n        },\n        \"security_level\": \"confidential\"\n    }\n]\n```\n\n#### Masking Algorithms\n\n| Algorithm | Description | Example |\n|:----------|:------------|:--------|\n| `phone_mask` | Masks phone numbers | `138****5678` |\n| `email_mask` | Masks email addresses | `j***n@example.com` |\n| `id_mask` | Masks ID card numbers | `110101****1234` |\n| `name_mask` | Masks personal names | `张*明` |\n| `partial_mask` | Partial masking with ratio | `abc***xyz` |\n\n#### Custom Masking Rules\n\nAdd custom masking rules in your configuration:\n\n```python\n# Custom masking rule\ncustom_rule = {\n    \"column_pattern\": r\".*salary.*|.*income.*\",\n    \"algorithm\": \"partial_mask\",\n    \"parameters\": {\n        \"mask_char\": \"*\",\n        \"mask_ratio\": 0.6\n    },\n    \"security_level\": \"confidential\"\n}\n```\n\n### Security Configuration Examples\n\n#### Environment Variables\n\n```bash\n# .env file\nAUTH_TYPE=token\nTOKEN_SECRET=your_jwt_secret_key\nENABLE_MASKING=true\nMAX_RESULT_ROWS=10000\nBLOCKED_SQL_OPERATIONS=DROP,DELETE,TRUNCATE,ALTER\nMAX_QUERY_COMPLEXITY=100\nENABLE_AUDIT=true\n```\n\n#### Sensitive Tables Configuration\n\n```python\n# Configure sensitive tables with security levels\nsensitive_tables = {\n    \"user_profiles\": \"confidential\",\n    \"payment_records\": \"secret\", \n    \"employee_salaries\": \"secret\",\n    \"customer_data\": \"confidential\",\n    \"public_reports\": \"public\"\n}\n```\n\n### Security Best Practices\n\n1. **🔑 Strong Authentication**: Use JWT tokens with proper expiration\n2. **🎯 Principle of Least Privilege**: Grant minimum required permissions\n3. **🔍 Regular Auditing**: Enable audit logging for security monitoring\n4. **🛡️ Input Validation**: All SQL queries are automatically validated\n5. **🎭 Data Classification**: Properly classify data with security levels\n6. **🔄 Regular Updates**: Keep security rules and configurations updated\n\n### Security Monitoring\n\nThe system provides comprehensive security monitoring:\n\n```python\n# Security audit log example\n{\n    \"timestamp\": \"2024-01-15T10:30:00Z\",\n    \"user_id\": \"analyst_user\",\n    \"action\": \"query_execution\", \n    \"resource\": \"customer_data\",\n    \"result\": \"blocked\",\n    \"reason\": \"insufficient_permissions\",\n    \"risk_level\": \"medium\"\n}\n```\n\n> **⚠️ Important**: Always test security configurations in a development environment before deploying to production. Regularly review and update security policies based on your organization's requirements.\n\n## Connecting with Cursor\n\nYou can connect Cursor to this MCP server using Stdio mode (recommended) or Streamable HTTP mode.\n\n### Stdio Mode\n\nStdio mode allows Cursor to manage the server process directly. Configuration is done within Cursor's MCP Server settings file (typically `~/.cursor/mcp.json` or similar).\n\n### Method 1: Using PyPI Installation (Recommended)\n\nInstall the package from PyPI and configure Cursor to use it:\n\n```bash\npip install mcp-doris-server\n```\n\n**Configure Cursor:** Add an entry like the following to your Cursor MCP configuration:\n\n```json\n{\n  \"mcpServers\": {\n    \"doris-stdio\": {\n      \"command\": \"doris-mcp-server\",\n      \"args\": [\"--transport\", \"stdio\"],\n      \"env\": {\n        \"DORIS_HOST\": \"127.0.0.1\",\n        \"DORIS_PORT\": \"9030\",\n        \"DORIS_USER\": \"root\",\n        \"DORIS_PASSWORD\": \"your_db_password\"\n      }\n    }\n  }\n}\n```\n\n### Method 2: Using uv (Development)\n\nIf you have `uv` installed and want to run from source:\n\n```bash\nuv run --project /path/to/doris-mcp-server doris-mcp-server\n```\n\n**Note:** Replace `/path/to/doris-mcp-server` with the actual absolute path to your project directory.\n\n**Configure Cursor:** Add an entry like the following to your Cursor MCP configuration:\n\n```json\n{\n  \"mcpServers\": {\n    \"doris-stdio\": {\n      \"command\": \"uv\",\n      \"args\": [\"run\", \"--project\", \"/path/to/your/doris-mcp-server\", \"doris-mcp-server\"],\n      \"env\": {\n        \"DORIS_HOST\": \"127.0.0.1\",\n        \"DORIS_PORT\": \"9030\",\n        \"DORIS_USER\": \"root\",\n        \"DORIS_PASSWORD\": \"your_db_password\"\n      }\n    }\n  }\n}\n```\n\n### Streamable HTTP Mode\n\nStreamable HTTP mode requires you to run the MCP server independently first, and then configure Cursor to connect to it.\n\n1.  **Configure `.env`:** Ensure your database credentials and any other necessary settings are correctly configured in the `.env` file within the project directory.\n2.  **Start the Server:** Run the server from your terminal in the project's root directory:\n    ```bash\n    ./start_server.sh\n    ```\n    This script reads the `.env` file and starts the FastAPI server with Streamable HTTP support. Note the host and port the server is listening on (default is `0.0.0.0:3000`).\n3.  **Configure Cursor:** Add an entry like the following to your Cursor MCP configuration, pointing to the running server's Streamable HTTP endpoint:\n\n    ```json\n    {\n      \"mcpServers\": {\n        \"doris-http\": {\n           \"url\": \"http://127.0.0.1:3000/mcp\"\n        }\n      }\n    }\n    ```\n    \n    > **Note**: Adjust the host/port if your server runs on a different address. The `/mcp` endpoint is the unified Streamable HTTP interface.\n\nAfter configuring either mode in Cursor, you should be able to select the server (e.g., `doris-stdio` or `doris-http`) and use its tools.\n\n## Directory Structure\n\n```\ndoris-mcp-server/\n├── doris_mcp_server/           # Main server package\n│   ├── main.py                 # Main entry point and FastAPI app\n│   ├── tools/                  # MCP tools implementation\n│   │   ├── tools_manager.py    # Centralized tools management and registration\n│   │   ├── resources_manager.py # Resource management and metadata exposure\n│   │   ├── prompts_manager.py  # Intelligent prompt templates for data analysis\n│   │   └── __init__.py\n│   ├── utils/                  # Core utility modules\n│   │   ├── config.py           # Configuration management with validation\n│   │   ├── db.py               # Database connection management with pooling\n│   │   ├── query_executor.py   # High-performance SQL execution with caching\n│   │   ├── security.py         # Security management and data masking\n│   │   ├── schema_extractor.py # Metadata extraction with catalog federation\n│   │   ├── analysis_tools.py   # Data analysis and performance monitoring\n│   │   ├── logger.py           # Logging configuration\n│   │   └── __init__.py\n│   └── __init__.py\n├── doris_mcp_client/           # MCP client implementation\n│   ├── client.py               # Unified MCP client for testing and integration\n│   ├── README.md               # Client documentation\n│   └── __init__.py\n├── logs/                       # Log files directory\n├── README.md                   # This documentation\n├── .env.example                # Environment variables template\n├── requirements.txt            # Python dependencies\n├── pyproject.toml              # Project configuration and entry points\n├── uv.lock                     # UV package manager lock file\n├── generate_requirements.py    # Requirements generation script\n├── start_server.sh             # Server startup script\n└── restart_server.sh           # Server restart script\n```\n\n## Developing New Tools\n\nThis section outlines the process for adding new MCP tools to the Doris MCP Server, based on the unified modular architecture with centralized tool management.\n\n### 1. Leverage Existing Utility Modules\n\nThe server provides comprehensive utility modules for common database operations:\n\n*   **`doris_mcp_server/utils/db.py`**: Database connection management with connection pooling and health monitoring.\n*   **`doris_mcp_server/utils/query_executor.py`**: High-performance SQL execution with advanced caching, optimization, and performance monitoring.\n*   **`doris_mcp_server/utils/schema_extractor.py`**: Metadata extraction with full catalog federation support.\n*   **`doris_mcp_server/utils/security.py`**: Comprehensive security management, SQL validation, and data masking.\n*   **`doris_mcp_server/utils/analysis_tools.py`**: Advanced data analysis and statistical tools.\n*   **`doris_mcp_server/utils/config.py`**: Configuration management with validation.\n\n### 2. Implement Tool Logic\n\nAdd your new tool to the `DorisToolsManager` class in `doris_mcp_server/tools/tools_manager.py`. The tools manager provides a centralized approach to tool registration and execution with unified interfaces.\n\n**Example:** Adding a new analysis tool:\n\n```python\n# In doris_mcp_server/tools/tools_manager.py\n\nasync def your_new_analysis_tool(self, arguments: Dict[str, Any]) -> List[Dict[str, Any]]:\n    \"\"\"\n    Your new analysis tool implementation\n    \n    Args:\n        arguments: Tool arguments from MCP client\n        \n    Returns:\n        List of MCP response messages\n    \"\"\"\n    try:\n        # Use existing utilities\n        result = await self.query_executor.execute_sql_for_mcp(\n            sql=\"SELECT COUNT(*) FROM your_table\",\n            max_rows=arguments.get(\"max_rows\", 100)\n        )\n        \n        return [{\n            \"type\": \"text\",\n            \"text\": json.dumps(result, ensure_ascii=False, indent=2)\n        }]\n        \n    except Exception as e:\n        logger.error(f\"Tool execution failed: {str(e)}\", exc_info=True)\n        return [{\n            \"type\": \"text\", \n            \"text\": f\"Error: {str(e)}\"\n        }]\n```\n\n### 3. Register the Tool\n\nAdd your tool to the `_register_tools` method in the same class:\n\n```python\n# In the _register_tools method of DorisToolsManager\n\n@self.mcp.tool(\n    name=\"your_new_analysis_tool\",\n    description=\"Description of your new analysis tool\",\n    inputSchema={\n        \"type\": \"object\",\n        \"properties\": {\n            \"parameter1\": {\n                \"type\": \"string\",\n                \"description\": \"Description of parameter1\"\n            },\n            \"parameter2\": {\n                \"type\": \"integer\", \n                \"description\": \"Description of parameter2\",\n                \"default\": 100\n            }\n        },\n        \"required\": [\"parameter1\"]\n    }\n)\nasync def your_new_analysis_tool_wrapper(arguments: Dict[str, Any]) -> List[Dict[str, Any]]:\n    return await self.your_new_analysis_tool(arguments)\n```\n\n### 4. Advanced Features\n\nFor more complex tools, you can leverage the comprehensive framework:\n\n*   **Advanced Caching**: Use the query executor's built-in caching for enhanced performance\n*   **Enterprise Security**: Apply comprehensive SQL validation and data masking through the security manager\n*   **Intelligent Prompts**: Use the prompts manager for advanced query generation\n*   **Resource Management**: Expose metadata through the resources manager\n*   **Performance Monitoring**: Integrate with the analysis tools for monitoring capabilities\n\n### 5. Testing\n\nTest your new tool using the included MCP client:\n\n```python\n# Using doris_mcp_client/client.py\nfrom doris_mcp_client.client import DorisUnifiedMCPClient\n\nasync def test_new_tool():\n    client = DorisUnifiedMCPClient()\n    result = await client.call_tool(\"your_new_analysis_tool\", {\n        \"parameter1\": \"test_value\",\n        \"parameter2\": 50\n    })\n    print(result)\n```\n\n## MCP Client\n\nThe project includes a unified MCP client (`doris_mcp_client/`) for testing and integration purposes. The client supports multiple connection modes and provides a convenient interface for interacting with the MCP server.\n\nFor detailed client documentation, see [`doris_mcp_client/README.md`](doris_mcp_client/README.md).\n\n## Contributing\n\nContributions are welcome via Issues or Pull Requests.\n\n## License\n\nThis project is licensed under the Apache 2.0 License. See the LICENSE file for details. \n\n## FAQ\n\n### Q: Why do Qwen3-32b and other small parameter models always fail when calling tools?\n\n**A:** This is a common issue. The main reason is that these models need more explicit guidance to correctly use MCP tools. It's recommended to add the following instruction prompt for the model:\n\n- Chinese version：\n\n```xml\n<instruction>\n尽可能使用MCP工具完成任务，仔细阅读每个工具的注解、方法名、参数说明等内容。请按照以下步骤操作：\n\n1. 仔细分析用户的问题，从已有的Tools列表中匹配最合适的工具。\n2. 确保工具名称、方法名和参数完全按照工具注释中的定义使用，不要自行创造工具名称或参数。\n3. 传入参数时，严格遵循工具注释中规定的参数格式和要求。\n4. 调用工具时，根据需要直接调用工具，但参数请求参考以下请求格式：{\"mcp_sse_call_tool\": {\"tool_name\": \"$tools_name\", \"arguments\": \"{}\"}}\n5. 输出结果时，不要包含任何XML标签，仅返回纯文本内容。\n\n<input>\n用户问题：user_query\n</input>\n\n<output>\n返回工具调用结果或最终答案，以及对结果的分析。\n</output>\n</instruction>\n```\n- English version：\n\n```xml\n<instruction>\nUse MCP tools to complete tasks as much as possible. Carefully read the annotations, method names, and parameter descriptions of each tool. Please follow these steps:\n\n1. Carefully analyze the user's question and match the most appropriate tool from the existing Tools list.\n2. Ensure tool names, method names, and parameters are used exactly as defined in the tool annotations. Do not create tool names or parameters on your own.\n3. When passing parameters, strictly follow the parameter format and requirements specified in the tool annotations.\n4. When calling tools, call them directly as needed, but refer to the following request format for parameters: {\"mcp_sse_call_tool\": {\"tool_name\": \"$tools_name\", \"arguments\": \"{}\"}}\n5. When outputting results, do not include any XML tags, return plain text content only.\n\n<input>\nUser question: user_query\n</input>\n\n<output>\nReturn tool call results or final answer, along with analysis of the results.\n</output>\n</instruction>\n```\n\nIf you have further requirements for the returned results, you can describe the specific requirements in the `<output>` tag.\n\n### Q: How to configure different database connections?\n\n**A:** You can configure database connections in several ways:\n\n1. **Environment Variables** (Recommended):\n   ```bash\n   export DORIS_HOST=\"your_doris_host\"\n   export DORIS_PORT=\"9030\"\n   export DORIS_USER=\"root\"\n   export DORIS_PASSWORD=\"your_password\"\n   ```\n\n2. **Command Line Arguments**:\n   ```bash\n   doris-mcp-server --db-host your_host --db-port 9030 --db-user root --db-password your_password\n   ```\n\n3. **Configuration File**:\n   Modify the corresponding configuration items in the `.env` file.\n\n### Q: How to configure BE nodes for monitoring tools?\n\n**A:** Choose the appropriate configuration based on your deployment scenario:\n\n**External Network (Manual Configuration):**\n```bash\n# Manually specify BE node addresses\nDORIS_BE_HOSTS=10.1.1.100,10.1.1.101,10.1.1.102\nDORIS_BE_WEBSERVER_PORT=8040\n```\n\n**Internal Network (Automatic Discovery):**\n```bash\n# Leave BE_HOSTS empty for auto-discovery\n# DORIS_BE_HOSTS=  # Not set or empty\n# System will use 'SHOW BACKENDS' command to get internal IPs\n```\n\n### Q: How to use SQL Explain/Profile files with LLM for optimization?\n\n**A:** The tools provide both truncated content and complete files for LLM analysis:\n\n1. **Get Analysis Results:**\n   ```json\n   {\n     \"content\": \"Truncated plan for immediate review\",\n     \"file_path\": \"/tmp/explain_12345.txt\",\n     \"is_content_truncated\": true\n   }\n   ```\n\n2. **LLM Analysis Workflow:**\n   - Review truncated content for quick insights\n   - Upload the complete file to your LLM as an attachment\n   - Request optimization suggestions or performance analysis\n   - Implement recommended improvements\n\n3. **Configure Content Size:**\n   ```bash\n   MAX_RESPONSE_CONTENT_SIZE=4096  # Adjust as needed\n   ```\n\n### Q: How to enable data security and masking features?\n\n**A:** Set the following configurations in your `.env` file:\n\n```bash\n# Enable data masking\nENABLE_MASKING=true\n# Set authentication type\nAUTH_TYPE=token\n# Configure token secret\nTOKEN_SECRET=your_secret_key\n# Set maximum result rows\nMAX_RESULT_ROWS=10000\n```\n\n### Q: What's the difference between Stdio mode and HTTP mode?\n\n**A:** \n\n- **Stdio Mode**: Suitable for direct integration with MCP clients (like Cursor), where the client manages the server process\n- **HTTP Mode**: Independent web service that supports multiple client connections, suitable for production environments\n\nRecommendations:\n- Development and personal use: Stdio mode\n- Production and multi-user environments: HTTP mode\n\n### Q: How to resolve connection timeout issues?\n\n**A:** Try the following solutions:\n\n1. **Increase timeout settings**:\n   ```bash\n   # Set in .env file\n   QUERY_TIMEOUT=60\n   CONNECTION_TIMEOUT=30\n   ```\n\n2. **Check network connectivity**:\n   ```bash\n   # Test database connection\n   curl http://localhost:3000/health\n   ```\n\n3. **Optimize connection pool configuration**:\n   ```bash\n   DORIS_MIN_CONNECTIONS=5\n   DORIS_MAX_CONNECTIONS=20\n   ```\n\n### Q: How to view server logs?\n\n**A:** Log files are located in the `logs/` directory. You can:\n\n1. **View real-time logs**:\n   ```bash\n   tail -f logs/doris_mcp_server.log\n   ```\n\n2. **Adjust log level**:\n   ```bash\n   # Set in .env file\n   LOG_LEVEL=DEBUG\n   ```\n\n3. **Enable audit logging**:\n   ```bash\n   ENABLE_AUDIT=true\n   ```\n\nFor other issues, please check GitHub Issues or submit a new issue. \n"
}