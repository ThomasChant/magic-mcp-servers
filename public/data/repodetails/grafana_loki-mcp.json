{
  "mcp_name": "scottlepp/loki-mcp",
  "mcp_description": "Facilitates querying Grafana Loki log data using the Model Context Protocol (MCP) with a Go-based server.",
  "mcp_id": "grafana_loki-mcp",
  "fetch_timestamp": "2025-06-23T08:12:17.544087Z",
  "github_url": "https://github.com/scottlepp/loki-mcp",
  "repository": {
    "name": "loki-mcp",
    "full_name": "grafana/loki-mcp",
    "description": "An MCP ( Model Context Protocol ) Server for Grafana Loki",
    "html_url": "https://github.com/grafana/loki-mcp",
    "created_at": "2025-04-10T14:18:03Z",
    "updated_at": "2025-06-23T05:42:54Z",
    "pushed_at": "2025-06-20T17:04:52Z",
    "size": 6055,
    "stargazers_count": 8,
    "watchers_count": 8,
    "forks_count": 2,
    "open_issues_count": 0,
    "language": "Go",
    "license": null,
    "topics": [
      "agentic-ai",
      "agentic-workflow",
      "golang",
      "grafana",
      "loki",
      "mcp",
      "mcp-server"
    ],
    "default_branch": "main",
    "owner": {
      "login": "grafana",
      "type": "Organization",
      "avatar_url": "https://avatars.githubusercontent.com/u/7195757?v=4",
      "html_url": "https://github.com/grafana"
    },
    "has_issues": true,
    "has_projects": true,
    "has_downloads": true,
    "has_wiki": false,
    "has_pages": false,
    "archived": false,
    "disabled": false,
    "visibility": "public",
    "network_count": 2,
    "subscribers_count": 1,
    "languages": {
      "Go": 26762,
      "Shell": 5967,
      "Makefile": 1102,
      "Dockerfile": 547
    },
    "language_percentages": {
      "Go": 77.85,
      "Shell": 17.36,
      "Makefile": 3.21,
      "Dockerfile": 1.59
    },
    "pull_requests_count": 5,
    "contributors_count": 2,
    "latest_release": {
      "tag_name": "v0.3.0",
      "name": "v0.3.0",
      "published_at": "2025-06-19T17:42:25Z",
      "body": "## What's Changed\r\n* allow default env vars for credentials and org by @scottlepp in https://github.com/scottlepp/loki-mcp/pull/8\r\n\r\n\r\n**Full Changelog**: https://github.com/scottlepp/loki-mcp/compare/v0.2.0...v0.3.0",
      "prerelease": false,
      "draft": false
    },
    "tags": [
      {
        "name": "v0.3.0",
        "commit_sha": "247dc56b2089cf110736625780fea4c2d3310aeb"
      },
      {
        "name": "v0.2.0",
        "commit_sha": "b0d9aa4b6c40950bfef63419538e228e6318ec2e"
      },
      {
        "name": "v0.1.0",
        "commit_sha": "798ec4c0845daffe59f61614fe48b132cd12609b"
      }
    ],
    "latest_version": "v0.3.0"
  },
  "readme": "# Loki MCP Server\n\n[![CI](https://github.com/scottlepp/loki-mcp/workflows/CI/badge.svg)](https://github.com/scottlepp/loki-mcp/actions/workflows/ci.yml)\n\nA Go-based server implementation for the Model Context Protocol (MCP) with Grafana Loki integration.\n\n## Getting Started\n\n### Prerequisites\n\n- Go 1.16 or higher\n\n### Building and Running\n\nBuild and run the server:\n\n```bash\n# Build the server\ngo build -o loki-mcp-server ./cmd/server\n\n# Run the server\n./loki-mcp-server\n```\n\nOr run directly with Go:\n\n```bash\ngo run ./cmd/server\n```\n\nThe server communicates using stdin/stdout following the Model Context Protocol (MCP). This makes it suitable for use with Claude Desktop and other MCP-compatible clients. It does not run as an HTTP server on a port.\n\n## Project Structure\n\n```\n.\n├── cmd/\n│   ├── server/       # MCP server implementation\n│   └── client/       # Client for testing the MCP server\n├── internal/\n│   ├── handlers/     # Tool handlers\n│   └── models/       # Data models\n├── pkg/\n│   └── utils/        # Utility functions and shared code\n└── go.mod            # Go module definition\n```\n\n## MCP Server\n\nThe Loki MCP Server implements the Model Context Protocol (MCP) and provides the following tools:\n\n### Loki Query Tool\n\nThe `loki_query` tool allows you to query Grafana Loki log data:\n\n- Required parameters:\n  - `query`: LogQL query string\n\n- Optional parameters:\n  - `url`: The Loki server URL (default: from LOKI_URL environment variable or http://localhost:3100)\n  - `start`: Start time for the query (default: 1h ago)\n  - `end`: End time for the query (default: now)\n  - `limit`: Maximum number of entries to return (default: 100)\n  - `org`: Organization ID for the query (sent as X-Scope-OrgID header)\n\n#### Environment Variables\n\nThe Loki query tool supports the following environment variables:\n\n- `LOKI_URL`: Default Loki server URL to use if not specified in the request\n- `LOKI_ORG_ID`: Default organization ID to use if not specified in the request\n- `LOKI_USERNAME`: Default username for basic authentication if not specified in the request\n- `LOKI_PASSWORD`: Default password for basic authentication if not specified in the request\n- `LOKI_TOKEN`: Default bearer token for authentication if not specified in the request\n\n**Security Note**: When using authentication environment variables, be careful not to expose sensitive credentials in logs or configuration files. Consider using token-based authentication over username/password when possible.\n\n### Testing the MCP Server\n\nYou can test the MCP server using the provided client:\n\n```bash\n# Build the client\ngo build -o loki-mcp-client ./cmd/client\n\n# Loki query examples:\n./loki-mcp-client loki_query \"{job=\\\"varlogs\\\"}\"\n./loki-mcp-client loki_query \"{job=\\\"varlogs\\\"}\" \"-1h\" \"now\" 100\n\n# Using environment variables:\nexport LOKI_URL=\"http://localhost:3100\"\n./loki-mcp-client loki_query \"{job=\\\"varlogs\\\"}\"\n\n# Using environment variables for both URL and org:\nexport LOKI_URL=\"http://localhost:3100\"\nexport LOKI_ORG_ID=\"tenant-123\"\n./loki-mcp-client loki_query \"{job=\\\"varlogs\\\"}\"\n\n# Using environment variables for authentication:\nexport LOKI_URL=\"http://localhost:3100\"\nexport LOKI_USERNAME=\"admin\"\nexport LOKI_PASSWORD=\"password\"\n./loki-mcp-client loki_query \"{job=\\\"varlogs\\\"}\"\n\n# Using environment variables with bearer token:\nexport LOKI_URL=\"http://localhost:3100\"\nexport LOKI_TOKEN=\"your-bearer-token\"\n./loki-mcp-client loki_query \"{job=\\\"varlogs\\\"}\"\n\n# Using all environment variables together:\nexport LOKI_URL=\"http://localhost:3100\"\nexport LOKI_ORG_ID=\"tenant-123\"\nexport LOKI_USERNAME=\"admin\"\nexport LOKI_PASSWORD=\"password\"\n./loki-mcp-client loki_query \"{job=\\\"varlogs\\\"}\"\n\n# Using org parameter for multi-tenant setups:\n./loki-mcp-client loki_query \"{job=\\\"varlogs\\\"}\" \"\" \"\" \"\" \"\" \"\" \"tenant-123\"\n```\n\n## Docker Support\n\nYou can build and run the MCP server using Docker:\n\n```bash\n# Build the Docker image\ndocker build -t loki-mcp-server .\n\n# Run the server\ndocker run --rm -i loki-mcp-server\n```\n\nAlternatively, you can use Docker Compose:\n\n```bash\n# Build and run with Docker Compose\ndocker-compose up --build\n```\n\n### Local Testing with Loki\n\nThe project includes a complete Docker Compose setup to test Loki queries locally:\n\n1. Start the Docker Compose environment:\n   ```bash\n   docker-compose up -d\n   ```\n\n   This will start:\n   - A Loki server on port 3100\n   - A Grafana instance on port 3000 (pre-configured with Loki as a data source)\n   - A log generator container that sends sample logs to Loki\n   - The Loki MCP server\n\n2. Use the provided test script to query logs:\n   ```bash\n   # Run with default parameters (queries last 15 minutes of logs)\n   ./test-loki-query.sh\n   \n   # Query for error logs\n   ./test-loki-query.sh '{job=\"varlogs\"} |= \"ERROR\"'\n   \n   # Specify a custom time range and limit\n   ./test-loki-query.sh '{job=\"varlogs\"}' '-1h' 'now' 50\n   ```\n\n3. Insert dummy logs for testing:\n   ```bash\n   # Insert 10 dummy logs with default settings\n   ./insert-loki-logs.sh\n   \n   # Insert 20 logs with custom job and app name\n   ./insert-loki-logs.sh --num 20 --job \"custom-job\" --app \"my-app\"\n   \n   # Insert logs with custom environment and interval\n   ./insert-loki-logs.sh --env \"production\" --interval 0.5\n   \n   # Show help message\n   ./insert-loki-logs.sh --help\n   ```\n\n4. Access the Grafana UI at http://localhost:3000 to explore logs visually.\n\n## Server-Sent Events (SSE) Support\n\nThe server now supports two modes of communication:\n1. Standard input/output (stdin/stdout) following the Model Context Protocol (MCP)\n2. HTTP Server with Server-Sent Events (SSE) endpoint for integration with tools like n8n\n\nThe default port for the HTTP server is 8080, but can be configured using the `SSE_PORT` environment variable.\n\n### Server Endpoints\n\nWhen running in HTTP mode, the server exposes the following endpoints:\n\n- SSE Endpoint: `http://localhost:8080/sse` - For real-time event streaming\n- MCP Endpoint: `http://localhost:8080/mcp` - For MCP protocol messaging\n\n### Using Docker with SSE\n\nWhen running the server with Docker, make sure to expose port 8080:\n\n```bash\n# Build the Docker image\ndocker build -t loki-mcp-server .\n\n# Run the server with port mapping\ndocker run -p 8080:8080 --rm -i loki-mcp-server\n```\n\n### n8n Integration\n\nYou can integrate the Loki MCP Server with n8n workflows:\n\n1. Install the MCP Client Tools node in n8n\n\n2. Configure the node with these parameters:\n   - **SSE Endpoint**: `http://your-server-address:8080/sse` (replace with your actual server address)\n   - **Authentication**: Choose appropriate authentication if needed\n   - **Tools to Include**: Choose which Loki tools to expose to the AI Agent\n\n3. Connect the MCP Client Tool node to an AI Agent node that will use the Loki querying capabilities\n\nExample workflow:\nTrigger → MCP Client Tool (Loki server) → AI Agent (Claude)\n\n## Architecture\n\nThe Loki MCP Server uses a modular architecture:\n\n- **Server**: The main MCP server implementation in `cmd/server/main.go`\n- **Client**: A test client in `cmd/client/main.go` for interacting with the MCP server\n- **Handlers**: Individual tool handlers in `internal/handlers/`\n  - `loki.go`: Grafana Loki query functionality\n\n## Using with Claude Desktop\n\nYou can use this MCP server with Claude Desktop to add Loki query tools. Follow these steps:\n\n### Option 1: Using the Compiled Binary\n\n1. Build the server:\n```bash\ngo build -o loki-mcp-server ./cmd/server\n```\n\n2. Add the configuration to your Claude Desktop configuration file using `claude_desktop_config_binary.json`.\n\n### Option 2: Using Go Run with a Shell Script\n\n1. Make the script executable:\n```bash\nchmod +x run-mcp-server.sh\n```\n\n2. Add the configuration to your Claude Desktop configuration file using `claude_desktop_config_script.json`.\n\n### Option 3: Using Docker (Recommended)\n\n1. Build the Docker image:\n```bash\ndocker build -t loki-mcp-server .\n```\n\n2. Add the configuration to your Claude Desktop configuration file using `claude_desktop_config_docker.json`.\n\n### Configuration Details\n\nThe Claude Desktop configuration file is located at:\n- On macOS: `~/Library/Application Support/Claude/claude_desktop_config.json`\n- On Windows: `%APPDATA%\\Claude\\claude_desktop_config.json`\n- On Linux: `~/.config/Claude/claude_desktop_config.json`\n\nYou can use one of the example configurations provided in this repository:\n- `claude_desktop_config.json`: Generic template\n- `claude_desktop_config_example.json`: Example using `go run` with the current path\n- `claude_desktop_config_binary.json`: Example using the compiled binary\n- `claude_desktop_config_script.json`: Example using a shell script (recommended for `go run`)\n- `claude_desktop_config_docker.json`: Example using Docker (most reliable)\n\n**Notes**:\n- When using `go run` with Claude Desktop, you may need to set several environment variables in both the script and the configuration file:\n  - `HOME`: The user's home directory\n  - `GOPATH`: The Go workspace directory\n  - `GOMODCACHE`: The Go module cache directory\n  - `GOCACHE`: The Go build cache directory\n  \n  These are required to ensure Go can find its modules and build cache when run from Claude Desktop.\n\n- Using Docker is the most reliable approach as it packages all dependencies and environment variables in a container.\n\nOr create your own configuration:\n\n```json\n{\n  \"mcpServers\": {\n    \"lokiserver\": {\n      \"command\": \"path/to/loki-mcp-server\",\n      \"args\": [],\n      \"env\": {\n        \"LOKI_URL\": \"http://localhost:3100\",\n        \"LOKI_ORG_ID\": \"your-default-org-id\",\n        \"LOKI_USERNAME\": \"your-username\",\n        \"LOKI_PASSWORD\": \"your-password\",\n        \"LOKI_TOKEN\": \"your-bearer-token\"\n      },\n      \"disabled\": false,\n      \"autoApprove\": [\"loki_query\"]\n    }\n  }\n}\n```\n\nMake sure to replace `path/to/loki-mcp-server` with the absolute path to the built binary or source code.\n\n4. Restart Claude Desktop.\n\n5. You can now use the tools in Claude:\n   - Loki query examples:\n     - \"Query Loki for logs with the query {job=\\\"varlogs\\\"}\"\n     - \"Find error logs from the last hour in Loki using query {job=\\\"varlogs\\\"} |= \\\"ERROR\\\"\"\n     - \"Show me the most recent 50 logs from Loki with job=varlogs\"\n     - \"Query Loki for logs with org 'tenant-123' using query {job=\\\"varlogs\\\"}\"\n\n### Using Organization ID in Natural Language Prompts\n\nWhen using this MCP server with Claude Desktop or other AI assistants, users can naturally mention the organization ID in their prompts in several ways:\n\n#### Direct Organization Reference\n- **\"Query Loki for logs from organization 'tenant-123' with the query {job=\\\"varlogs\\\"}\"**\n- **\"Search Loki logs for org 'production-env' using {job=\\\"web\\\"}\"**\n- **\"Get logs from organization ID 'client-abc' matching {service=\\\"api\\\"}\"**\n\n#### Contextual Organization Mentions\n- **\"Check the error logs for our production tenant (org: prod-001) using query {level=\\\"error\\\"}\"**\n- **\"Find all logs from customer organization 'customer-xyz' for the last hour\"**\n- **\"Query Loki with org tenant-456 to find logs matching {job=\\\"backend\\\"}\"**\n\n#### Multi-tenant Scenarios\n- **\"Switch to organization 'dev-team' and query {job=\\\"logs\\\"} for debugging\"**\n- **\"Use org 'staging-env' to search for warning logs in the last 2 hours\"**\n- **\"Search logs in tenant 'qa-environment' for any error messages\"**\n\n#### Combined with Other Parameters\n- **\"Query Loki for organization 'prod-cluster' from 2 hours ago to now with limit 50\"**\n- **\"Get the last 100 logs from org 'microservice-team' for query {app=\\\"payment\\\"}\"**\n\nWhen you mention any of these natural language prompts, the AI assistant will automatically map terms like \"organization\", \"org\", \"tenant\", or \"organization ID\" to the `org` parameter in the Loki query tool, which gets sent as the `X-Scope-OrgID` header to your Loki server for proper multi-tenant filtering.\n\nThe key is to naturally mention any specific parameters in your request - the AI will understand how to map them to the appropriate Loki query tool parameters. When parameters are not explicitly mentioned, the system will automatically use defaults from environment variables:\n- `LOKI_URL` for the Loki server URL\n- `LOKI_ORG_ID` for the organization ID  \n- `LOKI_USERNAME` and `LOKI_PASSWORD` for basic authentication\n- `LOKI_TOKEN` for bearer token authentication\n\nThis makes it very convenient to set up default connection parameters once and then use natural language queries without having to specify authentication details every time.\n\n## Using with Cursor\n\nYou can also integrate the Loki MCP server with the Cursor editor. To do this, add the following configuration to your Cursor settings:\n\nDocker configuration:\n\n```json\n{\n  \"mcpServers\": {\n    \"loki-mcp-server\": {\n      \"command\": \"docker\",\n      \"args\": [\"run\", \"--rm\", \"-i\", \n               \"-e\", \"LOKI_URL=http://host.docker.internal:3100\", \n               \"-e\", \"LOKI_ORG_ID=your-default-org-id\",\n               \"-e\", \"LOKI_USERNAME=your-username\",\n               \"-e\", \"LOKI_PASSWORD=your-password\",\n               \"-e\", \"LOKI_TOKEN=your-bearer-token\",\n               \"loki-mcp-server:latest\"]\n    }\n  }\n}\n```\n\nAfter adding this configuration, restart Cursor, and you'll be able to use the Loki query tool directly within the editor.\n\n## License\n\nThis project is licensed under the MIT License - see the LICENSE file for details.\n\n## Running Tests\n\nThe project includes comprehensive unit tests and CI/CD workflows to ensure reliability:\n\n```bash\n# Run all tests\ngo test ./...\n\n# Run tests with coverage\ngo test -coverprofile=coverage.out ./...\ngo tool cover -func=coverage.out\n\n# Run tests with race detection  \ngo test -race ./...\n```\n\n### Timestamp Bug Fix (Issue #3)\n\nThis project previously had a critical bug where timestamps were displayed as year 2262 instead of correct dates. This has been fixed and regression tests are in place:\n\n- **Root Cause**: Loki returns timestamps in nanoseconds, but the code was incorrectly treating them as seconds and multiplying by 1,000,000,000\n- **Fix**: Correctly handle nanosecond timestamps from Loki  \n- **Testing**: Comprehensive tests ensure timestamps display correctly (e.g., 2024, 2023) instead of 2262\n- **CI Protection**: Automated tests prevent regression of this critical bug\n\nThe tests specifically verify:\n- ✅ Timestamps show correct years instead of 2262\n- ✅ Multiple timestamp formats work correctly\n- ✅ Invalid timestamps have proper fallback behavior\n- ✅ Integration with real Loki instances\n\n"
}