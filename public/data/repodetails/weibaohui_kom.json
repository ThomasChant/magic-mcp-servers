{
  "mcp_name": "weibaohui/kom",
  "mcp_description": "ğŸï¸ â˜ï¸/ğŸ  - Provides MCP multi-cluster Kubernetes management and operations. It can be integrated as an SDK into your own project and includes nearly 50 built-in tools covering common DevOps and development scenarios. Supports both standard and CRD resources.",
  "mcp_id": "weibaohui_kom",
  "fetch_timestamp": "2025-06-23T09:25:21.496793Z",
  "github_url": "https://github.com/weibaohui/kom",
  "repository": {
    "name": "kom",
    "full_name": "weibaohui/kom",
    "description": "kom æ˜¯ä¸€ä¸ªç”¨äº Kubernetes æ“ä½œçš„å·¥å…·ï¼ŒSDKçº§çš„kubectlã€client-goçš„ä½¿ç”¨å°è£…ã€‚å¹¶ä¸”æ”¯æŒä½œä¸ºç®¡ç†k8s çš„ MCP serverã€‚ å®ƒæä¾›äº†ä¸€ç³»åˆ—åŠŸèƒ½æ¥ç®¡ç† Kubernetes èµ„æºï¼ŒåŒ…æ‹¬åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤å’Œè·å–èµ„æºï¼Œç”šè‡³ä½¿ç”¨SQLæŸ¥è¯¢k8sèµ„æºã€‚è¿™ä¸ªé¡¹ç›®æ”¯æŒå¤šç§ Kubernetes èµ„æºç±»å‹çš„æ“ä½œï¼Œå¹¶èƒ½å¤Ÿå¤„ç†è‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼ˆCRDï¼‰ã€‚ é€šè¿‡ä½¿ç”¨ komï¼Œä½ å¯ä»¥è½»æ¾åœ°è¿›è¡Œèµ„æºçš„å¢åˆ æ”¹æŸ¥å’Œæ—¥å¿—è·å–ä»¥åŠæ“ä½œPODå†…æ–‡ä»¶ç­‰åŠ¨ä½œã€‚",
    "html_url": "https://github.com/weibaohui/kom",
    "created_at": "2024-10-21T12:24:05Z",
    "updated_at": "2025-06-23T06:55:48Z",
    "pushed_at": "2025-06-20T14:35:42Z",
    "size": 1280,
    "stargazers_count": 116,
    "watchers_count": 116,
    "forks_count": 21,
    "open_issues_count": 3,
    "language": "Go",
    "license": "MIT License",
    "topics": [
      "client-go",
      "cluster",
      "crd",
      "k8s",
      "kom",
      "kubectl",
      "mcp",
      "sdk",
      "sql"
    ],
    "default_branch": "main",
    "owner": {
      "login": "weibaohui",
      "type": "User",
      "avatar_url": "https://avatars.githubusercontent.com/u/27042034?v=4",
      "html_url": "https://github.com/weibaohui"
    },
    "has_issues": true,
    "has_projects": true,
    "has_downloads": true,
    "has_wiki": true,
    "has_pages": false,
    "archived": false,
    "disabled": false,
    "visibility": "public",
    "network_count": 21,
    "subscribers_count": 4,
    "languages": {
      "Go": 689611
    },
    "language_percentages": {
      "Go": 100
    },
    "pull_requests_count": 45,
    "contributors_count": 3,
    "latest_release": {
      "tag_name": "v0.2.51",
      "name": "v0.2.51 ğŸŒˆ",
      "published_at": "2025-06-20T14:35:42Z",
      "body": "## Whatâ€™s Changed\r\n* feat(crd): æ·»åŠ è·å–HorizontalPodAutoscaleråˆ—è¡¨çš„åŠŸèƒ½ (#48) @weibaohui\r\n",
      "prerelease": false,
      "draft": false
    },
    "tags": [
      {
        "name": "v0.2.51",
        "commit_sha": "88502a4326f9a1c459441ab6c47f5ef96e5eef6e"
      },
      {
        "name": "v0.2.50",
        "commit_sha": "1f92f7b8766a47d97e72e3112b1a61b7cecb8e78"
      },
      {
        "name": "v0.2.49",
        "commit_sha": "bf4131976495650e4343bdffb596b66f0b832815"
      },
      {
        "name": "v0.2.48",
        "commit_sha": "d3f7774d2c4ff9094cf859b25286e768a1cd0fce"
      },
      {
        "name": "v0.2.47",
        "commit_sha": "a675e53269962e734161bc1789979c3c5e9368fa"
      },
      {
        "name": "v0.2.46",
        "commit_sha": "14cee26770e1d7da32b21e073a1f59f645bd2ea9"
      },
      {
        "name": "v0.2.45",
        "commit_sha": "a597a484e6822969c0696c169c3d7542004f12d6"
      },
      {
        "name": "v0.2.44",
        "commit_sha": "f8afb3d97e434ddbb7ccea9bd897efca0860b74c"
      },
      {
        "name": "v0.2.43",
        "commit_sha": "ec72c680f65098ee2c89bd4a763536f1593b273a"
      },
      {
        "name": "v0.2.42",
        "commit_sha": "985855d4f6d36c4874299f758747cbc26f64bc28"
      }
    ],
    "latest_version": "v0.2.51"
  },
  "readme": "# Kom - Kubernetes Operations Manager\n\n[English](README_en.md) | [ä¸­æ–‡](README.md)\n[![kom](https://img.shields.io/badge/License-MIT-blue?style=flat-square)](https://github.com/weibaohui/kom/blob/master/LICENSE)\n\n\n## ç®€ä»‹\n\n`kom` æ˜¯ä¸€ä¸ªç”¨äº Kubernetes æ“ä½œçš„å·¥å…·ï¼Œç›¸å½“äºSDKçº§çš„kubectlã€client-goçš„ä½¿ç”¨å°è£…ã€‚\nå®ƒæä¾›äº†ä¸€ç³»åˆ—åŠŸèƒ½æ¥ç®¡ç† Kubernetes èµ„æºï¼ŒåŒ…æ‹¬åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤å’Œè·å–èµ„æºã€‚è¿™ä¸ªé¡¹ç›®æ”¯æŒå¤šç§ Kubernetes èµ„æºç±»å‹çš„æ“ä½œï¼Œå¹¶èƒ½å¤Ÿå¤„ç†è‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼ˆCRDï¼‰ã€‚\né€šè¿‡ä½¿ç”¨ `kom`ï¼Œä½ å¯ä»¥è½»æ¾åœ°è¿›è¡Œèµ„æºçš„å¢åˆ æ”¹æŸ¥å’Œæ—¥å¿—è·å–ä»¥åŠæ“ä½œPODå†…æ–‡ä»¶ç­‰åŠ¨ä½œï¼Œç”šè‡³å¯ä»¥ä½¿ç”¨SQLè¯­å¥æ¥æŸ¥è¯¢ã€ç®¡ç†k8sèµ„æºã€‚\n\n## **ç‰¹ç‚¹**\n1. ç®€å•æ˜“ç”¨ï¼škom æä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ã€è·å–ã€åˆ—è¡¨ç­‰ï¼ŒåŒ…æ‹¬å¯¹å†…ç½®èµ„æºä»¥åŠCRDèµ„æºçš„æ“ä½œã€‚\n2. å¤šé›†ç¾¤æ”¯æŒï¼šé€šè¿‡RegisterClusterï¼Œä½ å¯ä»¥è½»æ¾åœ°ç®¡ç†å¤šä¸ª Kubernetes é›†ç¾¤ã€‚\n3. MCPæ”¯æŒï¼šæ”¯æŒå¤šé›†ç¾¤çš„MCPç®¡ç†,åŒæ—¶æ”¯æŒstdioã€sseä¸¤ç§æ¨¡å¼ï¼Œå†…ç½®48ç§å·¥å…·ï¼Œæ”¯æŒSSEæ¨¡å¼ï¼Œæ”¯æŒç§æœ‰åŒ–éƒ¨ç½²ï¼Œå¤šäººå…±äº«ã€‚æ”¯æŒè¶…è¿‡ç™¾ç§ç»„åˆæ“ä½œã€‚\n4. æ”¯æŒè·¨å‘½åç©ºé—´ï¼šé€šè¿‡kom.Namespace(\"default\",\"kube-system\").List(&items) è·¨å‘½åç©ºé—´æŸ¥è¯¢èµ„æºã€‚\n5. é“¾å¼è°ƒç”¨ï¼škom æä¾›äº†é“¾å¼è°ƒç”¨ï¼Œä½¿å¾—æ“ä½œèµ„æºæ›´åŠ ç®€å•å’Œç›´è§‚ã€‚\n6. æ”¯æŒè‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼ˆCRDï¼‰ï¼škom æ”¯æŒè‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼ˆCRDï¼‰ï¼Œä½ å¯ä»¥è½»æ¾åœ°å®šä¹‰å’Œæ“ä½œè‡ªå®šä¹‰èµ„æºã€‚\n7. æ”¯æŒå›è°ƒæœºåˆ¶ï¼Œè½»æ¾æ‹“å±•ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸å¿…è·Ÿk8sæ“ä½œå¼ºè€¦åˆã€‚\n8. æ”¯æŒPODå†…æ–‡ä»¶æ“ä½œï¼Œè½»æ¾ä¸Šä¼ ã€ä¸‹è½½ã€åˆ é™¤æ–‡ä»¶ã€‚\n9. æ”¯æŒé«˜é¢‘æ“ä½œå°è£…ï¼Œå¦‚deploymentçš„restarté‡å¯ã€scaleæ‰©ç¼©å®¹ã€å¯åœç­‰20ä½™é¡¹æ“ä½œåŠŸèƒ½ã€‚\n10. æ”¯æŒSQLæŸ¥è¯¢k8sèµ„æºã€‚select * from pod where metadata.namespace='kube-system' or metadata.namespace='default' order by  metadata.creationTimestamp desc \n11. æ”¯æŒæŸ¥è¯¢ç¼“å­˜ï¼Œåœ¨é«˜é¢‘ã€æ‰¹é‡æŸ¥è¯¢åœºæ™¯ä¸‹ï¼Œå¯è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½ã€‚åˆ—è¡¨è¿‡æ»¤æ¡ä»¶ä¸å—ç¼“å­˜å½±å“ã€‚\n\n\n\n## ç¤ºä¾‹ç¨‹åº\n**k8m** æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ Kubernetes ç®¡ç†å·¥å…·ï¼Œå®ƒåŸºäºkomã€amiså®ç°ï¼Œå•æ–‡ä»¶ï¼Œæ”¯æŒå¤šå¹³å°æ¶æ„ã€‚\n1. **ä¸‹è½½**ï¼šä» [https://github.com/weibaohui/k8m](https://github.com/weibaohui/k8m) ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ã€‚\n2. **è¿è¡Œ**ï¼šä½¿ç”¨ `./k8m` å‘½ä»¤å¯åŠ¨,è®¿é—®[http://127.0.0.1:3618](http://127.0.0.1:3618)ã€‚\n\n\n\n\n## å®‰è£…\n\n```bash\nimport (\n    \"github.com/weibaohui/kom\"\n    \"github.com/weibaohui/kom/callbacks\"\n)\nfunc main() {\n    // æ³¨å†Œå›è°ƒï¼ŒåŠ¡å¿…å…ˆæ³¨å†Œ\n    callbacks.RegisterInit()\n    // æ³¨å†Œé›†ç¾¤\n\tdefaultKubeConfig := os.Getenv(\"KUBECONFIG\")\n\tif defaultKubeConfig == \"\" {\n\t\tdefaultKubeConfig = filepath.Join(homedir.HomeDir(), \".kube\", \"config\")\n\t}\n\t_, _ = kom.Clusters().RegisterInCluster()\n\t_, _ = kom.Clusters().RegisterByPathWithID(defaultKubeConfig, \"default\")\n\tkom.Clusters().Show()\n\t// å…¶ä»–é€»è¾‘\n}\n```\n\n## ä½¿ç”¨ç¤ºä¾‹\n\n### 0. å¤šé›†ç¾¤ k8s MCP æ”¯æŒ\nåŒæ—¶æ”¯æŒstdioã€sseä¸¤ç§æ¨¡å¼\næ”¯æŒå¤šä¸ªtools æ”¯æŒã€‚åŒ…æ‹¬å¯¹ä»»æ„èµ„æºçš„æŸ¥è¯¢åˆ—è¡¨åˆ é™¤æè¿°æ“ä½œï¼Œä»¥åŠPODæ—¥å¿—è¯»å–æ“ä½œã€‚\n#### 1.é›†æˆåˆ°ä»£ç ä¸­\n```go\n// ä¸€è¡Œä»£ç å¯åŠ¨MCP Server\nmcp.RunMCPServer(\"kom mcp server\", \"0.0.1\", 9096)\n\n\n\n```\n#### 2. ç¼–è¯‘\n```shell\n# æºç å¯åŠ¨\ngo build main.go \n//ç¼–è¯‘ä¸ºkom\n```\n#### 3. å¯åŠ¨\nå¯åŠ¨åæ”¯æŒä¸¤ç§æ¨¡å¼ï¼Œä¸€ç§ä¸ºstdioï¼Œä¸€ç§sseã€‚\nç®¡ç†k8sé»˜è®¤ä½¿ç”¨KUBECONFIG envç¯å¢ƒå˜é‡ã€‚\n```shell\n# è®¾ç½®KUBECONFIGç¯å¢ƒå˜é‡\nexport KUBECONFIG = /Users/xxx/.kube/config\n```\n```shell\n# è¿è¡Œ\n./kom \n# MCP Server è®¿é—®åœ°å€\nhttp://IP:9096/sse\n```\næ­¤æ—¶ï¼Œç¼–è¯‘å¾—åˆ°çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯å½“åšstdio æ¨¡å¼ä½¿ç”¨ã€‚\nhttp://IP:9096/sse æ¨¡å¼ï¼Œå¯ä»¥å½“åšsse æ¨¡å¼ä½¿ç”¨ã€‚\n\n\n#### 4. é›†æˆåˆ°MCPå·¥å…·ä¸­\næ”¯æŒstdio\\sse ä¸¤ç§æ–¹å¼é›†æˆã€‚\né€‚åˆMCPå·¥å…·é›†æˆï¼Œå¦‚Cursorã€Claude Desktop(ä»…æ”¯æŒstdioæ¨¡å¼)ã€Windsurfç­‰ï¼Œæ­¤å¤–ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™äº›è½¯ä»¶çš„UIæ“ä½œç•Œé¢è¿›è¡Œæ·»åŠ ã€‚\n```json\n{\n  \"mcpServers\": {\n    \"kom\": {\n      \"type\": \"sse\",\n      \"url\": \"http://IP:9096/sse\"\n    }\n  }\n}\n```\n```json\n{\n    \"mcpServers\": {\n        \"k8m\": {\n            \"command\": \"path/to/kom\",\n            \"args\": []\n        }\n    }\n}\n```\n\n####  MCPå·¥å…·åˆ—è¡¨ï¼ˆ49ç§ï¼‰\n\n| ç±»åˆ«                 | æ–¹æ³•                             | æè¿°                                      |\n|--------------------|--------------------------------|-----------------------------------------|\n| **é›†ç¾¤ç®¡ç†ï¼ˆ1ï¼‰**        | `list_clusters`                | åˆ—å‡ºæ‰€æœ‰å·²æ³¨å†Œçš„Kubernetesé›†ç¾¤                    |\n| **éƒ¨ç½²ç®¡ç†ï¼ˆ12ï¼‰**       | `scale_deployment`             | æ‰©ç¼©å®¹Deployment                           |\n|                    | `restart_deployment`           | é‡å¯Deployment                            |\n|                    | `stop_deployment`              | åœæ­¢Deployment                            |\n|                    | `restore_deployment`           | æ¢å¤Deployment                            |\n|                    | `update_tag_deployment`        | æ›´æ–°Deploymenté•œåƒæ ‡ç­¾                        |\n|                    | `rollout_history_deployment`   | æŸ¥è¯¢Deploymentå‡çº§å†å²                        |\n|                    | `rollout_undo_deployment`      | å›æ»šDeployment                            |\n|                    | `rollout_pause_deployment`     | æš‚åœDeploymentå‡çº§                          |\n|                    | `rollout_resume_deployment`    | æ¢å¤Deploymentå‡çº§                          |\n|                    | `rollout_status_deployment`    | æŸ¥è¯¢Deploymentå‡çº§çŠ¶æ€                        |\n|                    | `hpa_list_deployment`          | æŸ¥è¯¢Deploymentçš„HPAåˆ—è¡¨                      |\n|                    | `list_deployment_pods`         | è·å–Deploymentç®¡ç†çš„Podåˆ—è¡¨                    |\n| **åŠ¨æ€èµ„æºç®¡ç†(å«CRDï¼Œ8)** | `get_k8s_resource`             | è·å–k8sèµ„æº                                 |\n|                    | `describe_k8s_resource`        | æè¿°k8sèµ„æº                                 |\n|                    | `delete_k8s_resource`          | åˆ é™¤k8sèµ„æº                                 |\n|                    | `list_k8s_resource`            | åˆ—è¡¨å½¢å¼è·å–k8sèµ„æº                             |\n|                    | `list_k8s_event`               | åˆ—è¡¨å½¢å¼è·å–k8säº‹ä»¶                             |\n|                    | `patch_k8s_resource`           | æ›´æ–°k8sèµ„æºï¼Œä»¥JSON Patchæ–¹å¼æ›´æ–°                 |                               |\n|                    | `label_k8s_resource`           | ä¸ºk8sèµ„æºæ·»åŠ æˆ–åˆ é™¤æ ‡ç­¾                           |\n|                    | `annotate_k8s_resource`        | ä¸ºk8sèµ„æºæ·»åŠ æˆ–åˆ é™¤æ³¨è§£                           |\n| **èŠ‚ç‚¹ç®¡ç†ï¼ˆ8ï¼‰**        | `taint_node`                   | ä¸ºèŠ‚ç‚¹æ·»åŠ æ±¡ç‚¹                                 |\n|                    | `untaint_node`                 | ä¸ºèŠ‚ç‚¹ç§»é™¤æ±¡ç‚¹                                 |\n|                    | `cordon_node`                  | ä¸ºèŠ‚ç‚¹è®¾ç½®Cordon                             |\n|                    | `uncordon_node`                | ä¸ºèŠ‚ç‚¹å–æ¶ˆCordon                             |\n|                    | `drain_node`                   | ä¸ºèŠ‚ç‚¹æ‰§è¡ŒDrain                              |\n|                    | `get_node_resource_usage`      | æŸ¥è¯¢èŠ‚ç‚¹çš„èµ„æºä½¿ç”¨æƒ…å†µ                             |\n|                    | `get_node_ip_usage`            | æŸ¥è¯¢èŠ‚ç‚¹ä¸ŠPod IPèµ„æºä½¿ç”¨æƒ…å†µ                       |\n|                    | `get_node_pod_count`           | æŸ¥è¯¢èŠ‚ç‚¹ä¸Šçš„Podæ•°é‡                             |\n| **Pod ç®¡ç†ï¼ˆ14ï¼‰**     | `list_pod_files`               | åˆ—å‡ºPodæ–‡ä»¶                                 |\n|                    | `list_all_pod_files`           | åˆ—å‡ºPodæ‰€æœ‰æ–‡ä»¶                               |\n|                    | `delete_pod_file`              | åˆ é™¤Podæ–‡ä»¶                                 |\n|                    | `upload_file_to_pod`           | ä¸Šä¼ æ–‡ä»¶åˆ°Podå†…ï¼Œæ”¯æŒä¼ é€’æ–‡æœ¬å†…å®¹ï¼Œå­˜å‚¨ä¸ºPodå†…æ–‡ä»¶            |\n|                    | `get_pod_logs`                 | è·å–Podæ—¥å¿—                                 |\n|                    | `run_command_in_pod`           | åœ¨Podä¸­æ‰§è¡Œå‘½ä»¤                               |\n|                    | `get_pod_linked_service`       | è·å–Podå…³è”çš„Service                         |\n|                    | `get_pod_linked_ingress`       | è·å–Podå…³è”çš„Ingress                         |\n|                    | `get_pod_linked_endpoints`     | è·å–Podå…³è”çš„Endpoints                       |\n|                    | `get_pod_linked_pvc`           | è·å–Podå…³è”çš„PVC                             |\n|                    | `get_pod_linked_pv`            | è·å–Podå…³è”çš„PV                              |\n|                    | `get_pod_linked_env`           | é€šè¿‡åœ¨podå†…è¿è¡Œenvå‘½ä»¤è·å–Podè¿è¡Œæ—¶ç¯å¢ƒå˜é‡              |\n|                    | `get_pod_linked_env_from_yaml` | é€šè¿‡Pod yamlå®šä¹‰è·å–Podè¿è¡Œæ—¶ç¯å¢ƒå˜é‡                |\n|                    | `get_pod_resource_usage`       | è·å–Podçš„èµ„æºä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬CPUå’Œå†…å­˜çš„è¯·æ±‚å€¼ã€é™åˆ¶å€¼ã€å¯åˆ†é…å€¼å’Œä½¿ç”¨æ¯”ä¾‹ |\n| **YAMLç®¡ç†ï¼ˆ2ï¼‰**      | `apply_yaml`                   | åº”ç”¨YAMLèµ„æº                                |\n|                    | `delete_yaml`                  | åˆ é™¤YAMLèµ„æº                                |\n| **å­˜å‚¨ç®¡ç†ï¼ˆ3ï¼‰**        | `set_default_storageclass`     | è®¾ç½®é»˜è®¤StorageClass                        |\n|                    | `get_storageclass_pvc_count`   | è·å–StorageClassä¸‹çš„PVCæ•°é‡                   |\n|                    | `get_storageclass_pv_count`    | è·å–StorageClassä¸‹çš„PVæ•°é‡                    |\n| **Ingressç®¡ç†ï¼ˆ1ï¼‰**   | `set_default_ingressclass`     | è®¾ç½®é»˜è®¤IngressClass                        |\n\n\n#### å¯åŠ¨å‘½ä»¤\n```go\nmcp.RunMCPServer(\"kom mcp server\", \"0.0.1\", 3619)\n```\n \n#### AIå·¥å…·é›†æˆ\n\n##### Claude Desktop\n1. æ‰“å¼€Claude Desktopè®¾ç½®é¢æ¿\n2. åœ¨APIé…ç½®åŒºåŸŸæ·»åŠ MCP Serveråœ°å€\n3. å¯ç”¨SSEäº‹ä»¶ç›‘å¬åŠŸèƒ½\n4. éªŒè¯è¿æ¥çŠ¶æ€\n```json\n{\n  \"mcpServers\": {\n    \"k8m\": {\n      \"command\": \"path/to/kom\",\n      \"args\": []\n    }\n  }\n}\n```\n\n##### Cursor\n1. è¿›å…¥Cursorè®¾ç½®ç•Œé¢\n2. æ‰¾åˆ°æ‰©å±•æœåŠ¡é…ç½®é€‰é¡¹\n3. æ”¯æŒsseã€stdioä¸¤ç§æ–¹å¼ã€‚sse æ–¹å¼å¡«å†™http://localhost:9096/sse,stdioæ–¹å¼å¡«å†™komçš„æ–‡ä»¶ä½ç½®ã€‚\n\n##### Windsurf\n1. è®¿é—®é…ç½®ä¸­å¿ƒ\n2. è®¾ç½®APIæœåŠ¡å™¨åœ°å€\n3. æ”¯æŒsseã€stdioä¸¤ç§æ–¹å¼ã€‚sse æ–¹å¼å¡«å†™http://localhost:9096/sse,stdioæ–¹å¼å¡«å†™komçš„æ–‡ä»¶ä½ç½®ã€‚\n\n#### cherry studio\n1. ç‚¹å‡»å·¦ä¸‹è§’è®¾ç½®\n2. ç‚¹å‡»MCP æœåŠ¡å™¨\n3. ç‚¹å‡»æ·»åŠ æœåŠ¡å™¨\n4. æ”¯æŒsseã€stdioä¸¤ç§æ–¹å¼ã€‚sse æ–¹å¼å¡«å†™http://localhost:9096/sse,stdioæ–¹å¼å¡«å†™komçš„æ–‡ä»¶ä½ç½®ã€‚\n\n\n### 1. å¤šé›†ç¾¤ç®¡ç†\n#### æ³¨å†Œå¤šé›†ç¾¤\n```go\n// æ³¨å†ŒInClusteré›†ç¾¤ï¼Œåç§°ä¸ºInCluster\nkom.Clusters().RegisterInCluster()\n// æ³¨å†Œä¸¤ä¸ªå¸¦åç§°çš„é›†ç¾¤,åˆ†åˆ«åä¸ºorbå’Œdocker-desktop\nkom.Clusters().RegisterByPathWithID(\"/Users/kom/.kube/orb\", \"orb\")\nkom.Clusters().RegisterByPathWithID(\"/Users/kom/.kube/config\", \"docker-desktop\")\n// æ³¨å†Œä¸€ä¸ªåä¸ºdefaultçš„é›†ç¾¤ï¼Œé‚£ä¹ˆkom.DefaultCluster()åˆ™ä¼šè¿”å›è¯¥é›†ç¾¤ã€‚\nkom.Clusters().RegisterByPathWithID(\"/Users/kom/.kube/config\", \"default\")\n```\n#### æ˜¾ç¤ºå·²æ³¨å†Œé›†ç¾¤\n```go\nkom.Clusters().Show()\n```\n#### é€‰æ‹©é»˜è®¤é›†ç¾¤\n```go\n// ä½¿ç”¨é»˜è®¤é›†ç¾¤,æŸ¥è¯¢é›†ç¾¤å†…kube-systemå‘½åç©ºé—´ä¸‹çš„pod\n// é¦–å…ˆå°è¯•è¿”å› ID ä¸º \"InCluster\" çš„å®ä¾‹ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œ\n// åˆ™å°è¯•è¿”å› ID ä¸º \"default\" çš„å®ä¾‹ã€‚\n// å¦‚æœä¸Šè¿°ä¸¤ä¸ªåç§°çš„å®ä¾‹éƒ½ä¸å­˜åœ¨ï¼Œåˆ™è¿”å› clusters åˆ—è¡¨ä¸­çš„ä»»æ„ä¸€ä¸ªå®ä¾‹ã€‚\nvar pods []corev1.Pod\nerr = kom.DefaultCluster().Resource(&corev1.Pod{}).Namespace(\"kube-system\").List(&pods).Error\n```\n#### é€‰æ‹©æŒ‡å®šé›†ç¾¤\n```go\n// é€‰æ‹©orbé›†ç¾¤,æŸ¥è¯¢é›†ç¾¤å†…kube-systemå‘½åç©ºé—´ä¸‹çš„pod\nvar pods []corev1.Pod\nerr = kom.Cluster(\"orb\").Resource(&corev1.Pod{}).Namespace(\"kube-system\").List(&pods).Error\n```\n\n### 2. å†…ç½®èµ„æºå¯¹è±¡çš„å¢åˆ æ”¹æŸ¥ä»¥åŠWatchç¤ºä¾‹\nå®šä¹‰ä¸€ä¸ª Deployment å¯¹è±¡ï¼Œå¹¶é€šè¿‡ kom è¿›è¡Œèµ„æºæ“ä½œã€‚\n```go\nvar item v1.Deployment\nvar items []v1.Deployment\n```\n#### åˆ›å»ºæŸä¸ªèµ„æº\n```go\nitem = v1.Deployment{\n\t\tObjectMeta: metav1.ObjectMeta{\n\t\t\tName:      \"nginx\",\n\t\t\tNamespace: \"default\",\n\t\t},\n\t\tSpec: v1.DeploymentSpec{\n\t\t\tTemplate: corev1.PodTemplateSpec{\n\t\t\t\tSpec: corev1.PodSpec{\n\t\t\t\t\tContainers: []corev1.Container{\n\t\t\t\t\t\t{Name: \"test\", Image: \"nginx:1.14.2\"},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t}\nerr := kom.DefaultCluster().Resource(&item).Create(&item).Error\n```\n#### GetæŸ¥è¯¢æŸä¸ªèµ„æº\n```go\n// æŸ¥è¯¢ default å‘½åç©ºé—´ä¸‹åä¸º nginx çš„ Deployment\nerr := kom.DefaultCluster().Resource(&item).Namespace(\"default\").Name(\"nginx\").Get(&item).Error\n// æŸ¥è¯¢ default å‘½åç©ºé—´ä¸‹åä¸º nginx çš„ Deploymentï¼Œå¹¶ä½¿ç”¨ç¼“å­˜ 5 ç§’\n// 5ç§’å†…ï¼Œä¸ä¼šå†æ¬¡æŸ¥è¯¢ï¼Œæ‰¹é‡æ“ä½œã€é«˜é¢‘æ“ä½œä¸‹ï¼Œå»ºè®®å¯ç”¨ç¼“å­˜\nerr := kom.DefaultCluster().Resource(&item).Namespace(\"default\").Name(\"nginx\").WithCache(5 * time.Second).Get(&item).Error\n```\n#### ListæŸ¥è¯¢èµ„æºåˆ—è¡¨\n```go\n// æŸ¥è¯¢ default å‘½åç©ºé—´ä¸‹çš„ Deployment åˆ—è¡¨\nerr := kom.DefaultCluster().Resource(&item).Namespace(\"default\").List(&items).Error\n// æŸ¥è¯¢ defaultã€kube-system å‘½åç©ºé—´ä¸‹çš„ Deployment åˆ—è¡¨\nerr := kom.DefaultCluster().Resource(&item).Namespace(\"default\",\"kube-system\").List(&items).Error\n// æŸ¥è¯¢ æ‰€æœ‰ å‘½åç©ºé—´ä¸‹çš„ Deployment åˆ—è¡¨\nerr := kom.DefaultCluster().Resource(&item).Namespace(\"*\").List(&items).Error\nerr := kom.DefaultCluster().Resource(&item).AllNamespace().List(&items).Error\n// è®¾ç½®5ç§’ç¼“å­˜ï¼Œå¯¹åˆ—è¡¨ç”Ÿæ•ˆ\nerr := kom.DefaultCluster().Resource(&item).WithCache(5 * time.Second).List(&nodeList).Error\n```\n#### é€šè¿‡LabelæŸ¥è¯¢èµ„æºåˆ—è¡¨\n```go\n// æŸ¥è¯¢ default å‘½åç©ºé—´ä¸‹ æ ‡ç­¾ä¸º app:nginx çš„ Deployment åˆ—è¡¨\nerr := kom.DefaultCluster().Resource(&item).Namespace(\"default\").WithLabelSelector(\"app=nginx\").List(&items).Error\n```\n#### é€šè¿‡å¤šä¸ªLabelæŸ¥è¯¢èµ„æºåˆ—è¡¨\n```go\n// æŸ¥è¯¢ default å‘½åç©ºé—´ä¸‹ æ ‡ç­¾ä¸º app:nginx m:n çš„ Deployment åˆ—è¡¨\nerr := kom.DefaultCluster().Resource(&item).Namespace(\"default\").WithLabelSelector(\"app=nginx\").WithLabelSelector(\"m=n\").List(&items).Error\n```\n#### é€šè¿‡FieldæŸ¥è¯¢èµ„æºåˆ—è¡¨\n```go\n// æŸ¥è¯¢ default å‘½åç©ºé—´ä¸‹ æ ‡ç­¾ä¸º metadata.name=test-deploy çš„ Deployment åˆ—è¡¨\n// filedSelector ä¸€èˆ¬æ”¯æŒåŸç”Ÿçš„å­—æ®µå®šä¹‰ã€‚å¦‚metadata.name,metadata.namespace,metadata.labels,metadata.annotations,metadata.creationTimestamp,spec.nodeName,spec.serviceAccountName,spec.schedulerName,status.phase,status.hostIP,status.podIP,status.qosClass,spec.containers.nameç­‰å­—æ®µ\nerr := kom.DefaultCluster().Resource(&item).Namespace(\"default\").WithFieldSelector(\"metadata.name=test-deploy\").List(&items).Error\n```\n#### åˆ†é¡µæŸ¥è¯¢èµ„æº\n```go\nvar list []corev1.Pod\nvar total int64\nsql := \"select * from pod where metadata.namespace=? or metadata.namespace=?     order by  metadata.creationTimestamp desc \"\nerr := kom.DefaultCluster().Sql(sql, \"kube-system\", \"default\").\n\t\tFillTotalCount(&total).\n\t\tLimit(5).\n\t\tOffset(10).\n\t\tList(&list).Error\nfmt.Printf(\"total %d\\n\", total)  //è¿”å›æ€»æ•° 480\nfmt.Printf(\"Count %d\\n\", len(list)) //è¿”å›æ¡ç›®æ•°=limit=5\n```\n#### æ›´æ–°èµ„æºå†…å®¹\n```go\n// æ›´æ–°åä¸ºnginx çš„ Deploymentï¼Œå¢åŠ ä¸€ä¸ªæ³¨è§£\nerr := kom.DefaultCluster().Resource(&item).Namespace(\"default\").Name(\"nginx\").Get(&item).Error\nif item.Spec.Template.Annotations == nil {\n\titem.Spec.Template.Annotations = map[string]string{}\n}\nitem.Spec.Template.Annotations[\"kom.kubernetes.io/restartedAt\"] = time.Now().Format(time.RFC3339)\nerr = kom.DefaultCluster().Resource(&item).Update(&item).Error\n```\n#### PATCH æ›´æ–°èµ„æº\n```go\n// ä½¿ç”¨ Patch æ›´æ–°èµ„æº,ä¸ºåä¸º nginx çš„ Deployment å¢åŠ ä¸€ä¸ªæ ‡ç­¾ï¼Œå¹¶è®¾ç½®å‰¯æœ¬æ•°ä¸º5\npatchData := `{\n    \"spec\": {\n        \"replicas\": 5\n    },\n    \"metadata\": {\n        \"labels\": {\n            \"new-label\": \"new-value\"\n        }\n    }\n}`\nerr := kom.DefaultCluster().Resource(&item).Patch(&item, types.StrategicMergePatchType, patchData).Error\n```\n#### åˆ é™¤èµ„æº\n```go\n// åˆ é™¤åä¸º nginx çš„ Deployment\nerr := kom.DefaultCluster().Resource(&item).Namespace(\"default\").Name(\"nginx\").Delete().Error\n```\n#### å¼ºåˆ¶åˆ é™¤èµ„æº\n```go\n// åˆ é™¤åä¸º nginx çš„ Deployment\nerr := kom.DefaultCluster().Resource(&item).Namespace(\"default\").Name(\"nginx\").ForceDelete().Error\n```\n#### é€šç”¨ç±»å‹èµ„æºçš„è·å–ï¼ˆé€‚ç”¨äºk8så†…ç½®ç±»å‹ä»¥åŠCRDï¼‰\n```go\n// æŒ‡å®šGVKè·å–èµ„æº\nvar list []corev1.Event\nerr := kom.DefaultCluster().GVK(\"events.k8s.io\", \"v1\", \"Event\").Namespace(\"default\").List(&list).Error\n```\n#### Watchèµ„æºå˜æ›´\n```go\n// watch default å‘½åç©ºé—´ä¸‹ Podèµ„æº çš„å˜æ›´\nvar watcher watch.Interface\nvar pod corev1.Pod\nerr := kom.DefaultCluster().Resource(&pod).Namespace(\"default\").Watch(&watcher).Error\nif err != nil {\n\tfmt.Printf(\"Create Watcher Error %v\", err)\n\treturn err\n}\ngo func() {\n\tdefer watcher.Stop()\n\n\tfor event := range watcher.ResultChan() {\n\t\terr := kom.DefaultCluster().Tools().ConvertRuntimeObjectToTypedObject(event.Object, &pod)\n\t\tif err != nil {\n\t\t\tfmt.Printf(\"æ— æ³•å°†å¯¹è±¡è½¬æ¢ä¸º *v1.Pod ç±»å‹: %v\", err)\n\t\t\treturn\n\t\t}\n\t\t// å¤„ç†äº‹ä»¶\n\t\tswitch event.Type {\n\t\tcase watch.Added:\n\t\t\tfmt.Printf(\"Added Pod [ %s/%s ]\\n\", pod.Namespace, pod.Name)\n\t\tcase watch.Modified:\n\t\t\tfmt.Printf(\"Modified Pod [ %s/%s ]\\n\", pod.Namespace, pod.Name)\n\t\tcase watch.Deleted:\n\t\t\tfmt.Printf(\"Deleted Pod [ %s/%s ]\\n\", pod.Namespace, pod.Name)\n\t\t}\n\t}\n}()\n```\n#### DescribeæŸ¥è¯¢æŸä¸ªèµ„æº\n```go\n// Describe default å‘½åç©ºé—´ä¸‹åä¸º nginx çš„ Deployment\nvar describeResult []byte\nerr := kom.DefaultCluster().Resource(&item).Namespace(\"default\").Name(\"nginx\").Describe(&item).Error\nfmt.Printf(\"describeResult: %s\", describeResult)\n```\n\n### 3. YAML åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤\n```go\nyaml := `apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: example-config\n  namespace: default\ndata:\n  key: value\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: example-deployment\n  namespace: default\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: example\n  template:\n    metadata:\n      labels:\n        app: example\n    spec:\n      containers:\n        - name: example-container\n          image: nginx\n`\n// ç¬¬ä¸€æ¬¡æ‰§è¡ŒApplyä¸ºåˆ›å»ºï¼Œè¿”å›æ¯ä¸€æ¡èµ„æºçš„æ‰§è¡Œç»“æœ \nresults := kom.DefaultCluster().Applier().Apply(yaml)\n// ç¬¬äºŒæ¬¡æ‰§è¡ŒApplyä¸ºæ›´æ–°ï¼Œè¿”å›æ¯ä¸€æ¡èµ„æºçš„æ‰§è¡Œç»“æœ\nresults = kom.DefaultCluster().Applier().Apply(yaml)\n// åˆ é™¤ï¼Œè¿”å›æ¯ä¸€æ¡èµ„æºçš„æ‰§è¡Œç»“æœ\nresults = kom.DefaultCluster().Applier().Delete(yaml)\n```\n\n### 4. Pod æ“ä½œ\n#### è·å–æ—¥å¿—\n```go\n// è·å–Podæ—¥å¿—\nvar stream io.ReadCloser\nerr := kom.DefaultCluster().Namespace(\"default\").Name(\"random-char-pod\").Ctl().Pod().ContainerName(\"container\").GetLogs(&stream, &corev1.PodLogOptions{}).Error\nreader := bufio.NewReader(stream)\nline, _ := reader.ReadString('\\n')\nfmt.Println(line)\n```\n#### æ‰§è¡Œå‘½ä»¤\nåœ¨Podå†…æ‰§è¡Œå‘½ä»¤ï¼Œéœ€è¦æŒ‡å®šå®¹å™¨åç§°ï¼Œå¹¶ä¸”ä¼šè§¦å‘Exec()ç±»å‹çš„callbacksã€‚\n```go\n// åœ¨Podå†…æ‰§è¡Œps -efå‘½ä»¤\nvar execResult string\nerr := kom.DefaultCluster().Namespace(\"default\").Name(\"random-char-pod\").Ctl().Pod().ContainerName(\"container\").Command(\"ps\", \"-ef\").ExecuteCommand(&execResult).Error\nfmt.Printf(\"execResult: %s\", execResult)\n```\n#### ç«¯å£è½¬å‘\n```go\nerr := kom.DefaultCluster().Resource(&v1.Pod{}).\n\t\tNamespace(\"default\").\n\t\tName(\"nginx-deployment-f576985cc-7czqr\").\n    Ctl().Pod().\n\t\tContainerName(\"nginx\").\n\t\tPortForward(\"20088\", \"80\", stopCh).Error\n// ç›‘å¬0.0.0.0ä¸Šçš„20088ç«¯å£ï¼Œè½¬å‘åˆ°Podçš„80ç«¯å£\n```\n#### æµå¼æ‰§è¡Œå‘½ä»¤\nåœ¨Podå†…æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶ä¸”ä¼šè§¦å‘StreamExec()ç±»å‹çš„callbacksã€‚é€‚åˆæ‰§è¡Œping ç­‰å‘½ä»¤\n```go\ncb := func(data []byte) error {\n\t\tfmt.Printf(\"Data %s\\n\", string(data))\n\t\treturn nil\n\t}\nerr := kom.DefaultCluster().Namespace(\"kube-system\").Name(\"traefik-d7c9c5778-p9nf4\").Ctl().Pod().ContainerName(\"traefik\").Command(\"ping\", \"127.0.0.1\").StreamExecute(cb, cb).Error\n//è¾“å‡ºï¼š\n//Data PING 127.0.0.1 (127.0.0.1): 56 data bytes\n//Data 64 bytes from 127.0.0.1: seq=0 ttl=42 time=0.023 ms\n//Data 64 bytes from 127.0.0.1: seq=1 ttl=42 time=0.011 ms\n//Data 64 bytes from 127.0.0.1: seq=2 ttl=42 time=0.012 ms\n//Data 64 bytes from 127.0.0.1: seq=3 ttl=42 time=0.016 ms\n```\n\n#### æ–‡ä»¶åˆ—è¡¨\n```go\n// è·å–Podå†…/etcæ–‡ä»¶å¤¹åˆ—è¡¨\nkom.DefaultCluster().Namespace(\"default\").Name(\"nginx\").Ctl().Pod().ContainerName(\"nginx\").ListFiles(\"/etc\")\n```\n#### æ‰€æœ‰æ–‡ä»¶åˆ—è¡¨ï¼ŒåŒ…æ‹¬éšè—æ–‡ä»¶\n```go\n// è·å–Podå†…/etcæ–‡ä»¶å¤¹åˆ—è¡¨\nkom.DefaultCluster().Namespace(\"default\").Name(\"nginx\").Ctl().Pod().ContainerName(\"nginx\").ListAllFiles(\"/etc\")\n```\n#### æ–‡ä»¶ä¸‹è½½\n```go\n// ä¸‹è½½Podå†…/etc/hostsæ–‡ä»¶\nkom.DefaultCluster().Namespace(\"default\").Name(\"nginx\").Ctl().Pod().ContainerName(\"nginx\").DownloadFile(\"/etc/hosts\")\n```\n#### æ–‡ä»¶ä¸‹è½½(Tarå‹ç¼©)\n```go\n// ä¸‹è½½Podå†…/etc/hostsæ–‡ä»¶ï¼Œä»¥taræ–¹å¼è¿›è¡Œæ‰“åŒ…åï¼Œè·å–ï¼Œä¸‹è½½\nkom.DefaultCluster().Namespace(\"default\").Name(\"nginx\").Ctl().Pod().ContainerName(\"nginx\").DownloadTarFile(\"/etc/hosts\")\n```\n#### æ–‡ä»¶ä¸Šä¼ \n```go\n// ä¸Šä¼ æ–‡ä»¶å†…å®¹åˆ°Podå†…/etc/demo.txtæ–‡ä»¶\nkom.DefaultCluster().Namespace(\"default\").Name(\"nginx\").Ctl().Pod().ContainerName(\"nginx\").SaveFile(\"/etc/demo.txt\", \"txt-context\")\n// os.File ç±»å‹æ–‡ä»¶ç›´æ¥ä¸Šä¼ åˆ°Podå†…/etc/ç›®å½•ä¸‹\nfile, _ := os.Open(tempFilePath)\nkom.DefaultCluster().Namespace(\"default\").Name(\"nginx\").Ctl().Pod().ContainerName(\"nginx\").UploadFile(\"/etc/\", file)\n```\n#### æ–‡ä»¶åˆ é™¤\n```go\n// åˆ é™¤Podå†…/etc/xyzæ–‡ä»¶\nkom.DefaultCluster().Namespace(\"default\").Name(\"nginx\").Ctl().Pod().ContainerName(\"nginx\").DeleteFile(\"/etc/xyz\")\n```\n#### è·å–å…³è”èµ„æº-Service\n```go\n// è·å–Podå…³è”çš„Service\nsvcs, err := kom.DefaultCluster().Namespace(\"default\").Name(\"nginx\").Ctl().Pod().LinkedService()\nfor _, svc := range svcs {\n\tfmt.Printf(\"service name %v\\n\", svc.Name)\n}\n```\n#### è·å–å…³è”èµ„æº-Ingress\n```go\n// è·å–Podå…³è”çš„Ingress\ningresses, err := kom.DefaultCluster().Namespace(\"default\").Name(\"nginx\").Ctl().Pod().LinkedIngress()\nfor _, ingress := range ingresses {\n\tfmt.Printf(\"ingress name %v\\n\", ingress.Name)\n}\n```\n#### è·å–å…³è”èµ„æº-PVC\n```go\n// è·å–Podå…³è”çš„PVC\npvcs, err := kom.DefaultCluster().Namespace(\"default\").Name(\"nginx\").Ctl().Pod().LinkedPVC()\nfor _, pvc := range pvcs {\n\tfmt.Printf(\"pvc name %v\\n\", pvc.Name)\n}\n``` \n#### è·å–å…³è”èµ„æº-PV\n```go\n// è·å–Podå…³è”çš„PVC\npvs, err := kom.DefaultCluster().Namespace(\"default\").Name(\"nginx\").Ctl().Pod().LinkedPV()\nfor _, pv := range pvs {\n\tfmt.Printf(\"pv name %v\\n\", pv.Name)\n}\n``` \n#### è·å–å…³è”èµ„æº-Endpoints\n```go\n// è·å–Podå…³è”çš„Endpoints\nendpoints, err := kom.DefaultCluster().Namespace(\"default\").Name(\"nginx\").Ctl().Pod().LinkedEndpoints()\nfor _, endpoint := range endpoints {\n\tfmt.Printf(\"endpoint name %v\\n\", endpoint.Name)\n}\n```\n#### è·å–å…³è”èµ„æº-è¿è¡Œæ—¶Env\nä»Podå†…æ‰§è¡Œenvå‘½ä»¤è·å¾—ENVé…ç½®ä¿¡æ¯\n```go\nenvs, err := kom.DefaultCluster().Namespace(\"default\").Name(\"nginx\").Ctl().Pod().LinkedEnv()\nfor _, env := range envs {\n\t\tfmt.Printf(\"env %s %s=%s\\n\", env.ContainerName, env.EnvName, env.EnvValue)\n\t}\n```\n#### è·å–å…³è”èµ„æº-å®šä¹‰Env\nä»podå®šä¹‰ä¸Šæå–ENVé…ç½®ä¿¡æ¯\n```go\nenvs, err := kom.DefaultCluster().Namespace(\"default\").Name(\"nginx\").Ctl().Pod().LinkedEnvFromPod()\nfor _, env := range envs {\n\t\tfmt.Printf(\"env %s %s=%s\\n\", env.ContainerName, env.EnvName, env.EnvValue)\n\t}\n```\n#### è·å–å…³è”èµ„æº-èŠ‚ç‚¹\næ ¹æ®Pod å®šä¹‰ä¸­å£°æ˜çš„NodeSelectorã€NodeAffinityã€æ±¡ç‚¹å®¹å¿åº¦ã€NodeNameç­‰é…ç½®ä¿¡æ¯ï¼Œè¿”å›å¯ç”¨èŠ‚ç‚¹åˆ—è¡¨ã€‚æš‚æœªè€ƒè™‘Podäº²å’Œæ€§ã€CPUå†…å­˜ç­‰è¿è¡Œæ—¶è°ƒåº¦å› ç´ ã€‚\n```go\nnodes, err := kom.DefaultCluster().Namespace(\"default\").Name(\"nginx\").Ctl().Pod().LinkedNode()\nfor _, node := range nodes {\n    fmt.Printf(\"reason:%s\\t node name %s\\n\", node.Reason, node.Name)\n}\n```\n\n### 5. è‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼ˆCRDï¼‰å¢åˆ æ”¹æŸ¥åŠWatchæ“ä½œ\nåœ¨æ²¡æœ‰CRå®šä¹‰çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œã€‚æ“ä½œæ–¹å¼åŒk8så†…ç½®èµ„æºã€‚\nå°†å¯¹è±¡å®šä¹‰ä¸ºunstructured.Unstructuredï¼Œå¹¶ä¸”éœ€è¦æŒ‡å®šGroupã€Versionã€Kindã€‚\nå› æ­¤å¯ä»¥é€šè¿‡kom.DefaultCluster().GVK(group, version, kind)æ¥æ›¿ä»£kom.DefaultCluster().Resource(interface{})\nä¸ºæ–¹ä¾¿è®°å¿†åŠä½¿ç”¨ï¼Œkomæä¾›äº†kom.DefaultCluster().CRD(group, version, kind)æ¥ç®€åŒ–æ“ä½œã€‚\nä¸‹é¢ç»™å‡ºæ“ä½œCRDçš„ç¤ºä¾‹ï¼š\né¦–å…ˆå®šä¹‰ä¸€ä¸ªé€šç”¨çš„å¤„ç†å¯¹è±¡ï¼Œç”¨æ¥æ¥æ”¶CRDçš„è¿”å›ç»“æœã€‚\n```go\nvar item unstructured.Unstructured\n```\n#### åˆ›å»ºCRD\n```go\nyaml := `apiVersion: apiextensions.k8s.io/v1\nkind: CustomResourceDefinition\nmetadata:\n  name: crontabs.stable.example.com\nspec:\n  group: stable.example.com\n  versions:\n    - name: v1\n      served: true\n      storage: true\n      schema:\n        openAPIV3Schema:\n          type: object\n          properties:\n            spec:\n              type: object\n              properties:\n                cronSpec:\n                  type: string\n                image:\n                  type: string\n                replicas:\n                  type: integer\n  scope: Namespaced\n  names:\n    plural: crontabs\n    singular: crontab\n    kind: CronTab\n    shortNames:\n    - ct`\nresult := kom.DefaultCluster().Applier().Apply(yaml)\n```\n#### åˆ›å»ºCRDçš„CRå¯¹è±¡\n```go\nitem = unstructured.Unstructured{\n\t\tObject: map[string]interface{}{\n\t\t\t\"apiVersion\": \"stable.example.com/v1\",\n\t\t\t\"kind\":       \"CronTab\",\n\t\t\t\"metadata\": map[string]interface{}{\n\t\t\t\t\"name\":      \"test-crontab\",\n\t\t\t\t\"namespace\": \"default\",\n\t\t\t},\n\t\t\t\"spec\": map[string]interface{}{\n\t\t\t\t\"cronSpec\": \"* * * * */8\",\n\t\t\t\t\"image\":    \"test-crontab-image\",\n\t\t\t},\n\t\t},\n\t}\nerr := kom.DefaultCluster().CRD(\"stable.example.com\", \"v1\", \"CronTab\").Namespace(item.GetNamespace()).Name(item.GetName()).Create(&item).Error\n```\n#### Getè·å–å•ä¸ªCRå¯¹è±¡\n```go\nerr := kom.DefaultCluster().CRD(\"stable.example.com\", \"v1\", \"CronTab\").Name(item.GetName()).Namespace(item.GetNamespace()).Get(&item).Error\n```\n#### Listè·å–CRå¯¹è±¡çš„åˆ—è¡¨\n```go\nvar crontabList []unstructured.Unstructured\n// æŸ¥è¯¢defaultå‘½åç©ºé—´ä¸‹çš„CronTab\nerr := kom.DefaultCluster().CRD(\"stable.example.com\", \"v1\", \"CronTab\").Namespace(crontab.GetNamespace()).List(&crontabList).Error\n// æŸ¥è¯¢æ‰€æœ‰å‘½åç©ºé—´ä¸‹çš„CronTab\nerr := kom.DefaultCluster().CRD(\"stable.example.com\", \"v1\", \"CronTab\").AllNamespace().List(&crontabList).Error\nerr := kom.DefaultCluster().CRD(\"stable.example.com\", \"v1\", \"CronTab\").Namespace(\"*\").List(&crontabList).Error\n```\n#### æ›´æ–°CRå¯¹è±¡\n```go\npatchData := `{\n    \"spec\": {\n        \"image\": \"patch-image\"\n    },\n    \"metadata\": {\n        \"labels\": {\n            \"new-label\": \"new-value\"\n        }\n    }\n}`\nerr := kom.DefaultCluster().CRD(\"stable.example.com\", \"v1\", \"CronTab\").Name(crontab.GetName()).Namespace(crontab.GetNamespace()).Patch(&crontab, types.StrategicMergePatchType, patchData).Error\n```\n#### åˆ é™¤CRå¯¹è±¡\n```go\nerr := kom.DefaultCluster().CRD(\"stable.example.com\", \"v1\", \"CronTab\").Name(crontab.GetName()).Namespace(crontab.GetNamespace()).Delete().Error\n```\n#### å¼ºåˆ¶åˆ é™¤CRå¯¹è±¡\n```go\nerr := kom.DefaultCluster().CRD(\"stable.example.com\", \"v1\", \"CronTab\").Name(crontab.GetName()).Namespace(crontab.GetNamespace()).ForceDelete().Error\n```\n#### Watch CRå¯¹è±¡\n```go\nvar watcher watch.Interface\n\nerr := kom.DefaultCluster().CRD(\"stable.example.com\", \"v1\", \"CronTab\").Namespace(\"default\").Watch(&watcher).Error\nif err != nil {\n    fmt.Printf(\"Create Watcher Error %v\", err)\n}\ngo func() {\n    defer watcher.Stop()\n    \n    for event := range watcher.ResultChan() {\n    var item *unstructured.Unstructured\n    \n    item, err := kom.DefaultCluster().Tools().ConvertRuntimeObjectToUnstructuredObject(event.Object)\n    if err != nil {\n        fmt.Printf(\"æ— æ³•å°†å¯¹è±¡è½¬æ¢ä¸º Unstructured ç±»å‹: %v\", err)\n        return\n    }\n    // å¤„ç†äº‹ä»¶\n    switch event.Type {\n        case watch.Added:\n            fmt.Printf(\"Added Unstructured [ %s/%s ]\\n\", item.GetNamespace(), item.GetName())\n        case watch.Modified:\n            fmt.Printf(\"Modified Unstructured [ %s/%s ]\\n\", item.GetNamespace(), item.GetName())\n        case watch.Deleted:\n            fmt.Printf(\"Deleted Unstructured [ %s/%s ]\\n\", item.GetNamespace(), item.GetName())\n        }\n    }\n}()\n```\n#### DescribeæŸ¥è¯¢æŸä¸ªCRDèµ„æº\n```go\n// Describe default å‘½åç©ºé—´ä¸‹åä¸º nginx çš„ Deployment\nvar describeResult []byte\nerr := kom.DefaultCluster().CRD(\"stable.example.com\", \"v1\", \"CronTab\").Namespace(\"default\").Name(item.GetName()).Describe(&item).Error\nfmt.Printf(\"describeResult: %s\", describeResult)\n```\n#### è·å–CRDä¸‹çš„Podèµ„æº\n```go\npods, err := kom.DefaultCluster().CRD(\"apps.kruise.io\", \"v1beta1\", \"StatefulSet\").\nNamespace(\"default\").Name(\"sample\").Ctl().CRD().ManagedPods()\n\tfor _, pod := range pods {\n\t\tfmt.Printf(\"Get pods: %v\", pod.GetName())\n\t}\n```\n\n### 6. é›†ç¾¤å‚æ•°ä¿¡æ¯\n```go\n// é›†ç¾¤æ–‡æ¡£\nkom.DefaultCluster().Status().Docs()\n// é›†ç¾¤èµ„æºä¿¡æ¯\nkom.DefaultCluster().Status().APIResources()\n// é›†ç¾¤å·²æ³¨å†ŒCRDåˆ—è¡¨\nkom.DefaultCluster().Status().CRDList()\n// é›†ç¾¤ç‰ˆæœ¬ä¿¡æ¯\nkom.DefaultCluster().Status().ServerVersion()\n```\n\n### 7. callbackæœºåˆ¶\n* å†…ç½®äº†callbackæœºåˆ¶ï¼Œå¯ä»¥è‡ªå®šä¹‰å›è°ƒå‡½æ•°ï¼Œå½“æ‰§è¡Œå®ŒæŸé¡¹æ“ä½œåï¼Œä¼šè°ƒç”¨å¯¹åº”çš„å›è°ƒå‡½æ•°ã€‚\n* å¦‚æœå›è°ƒå‡½æ•°è¿”å›trueï¼Œåˆ™ç»§ç»­æ‰§è¡Œåç»­æ“ä½œï¼Œå¦åˆ™ç»ˆæ­¢åç»­æ“ä½œã€‚\n* å½“å‰æ”¯æŒçš„callbackæœ‰ï¼šget,list,create,update,patch,delete,exec,stream-exec,logs,watch,doc.\n* å†…ç½®çš„callbackåç§°æœ‰ï¼š\"kom:get\",\"kom:list\",\"kom:create\",\"kom:update\",\"kom:patch\",\"kom:watch\",\"kom:delete\",\"kom:pod:exec\",\"kom:pod:stream:exec\",\"kom:pod:logs\",\"kom:pod:port:forward\",\"kom:doc\"\n* æ”¯æŒå›è°ƒå‡½æ•°æ’åºï¼Œé»˜è®¤æŒ‰æ³¨å†Œé¡ºåºæ‰§è¡Œï¼Œå¯ä»¥é€šè¿‡kom.DefaultCluster().Callback().After(\"kom:get\")æˆ–è€….Before(\"kom:get\")è®¾ç½®é¡ºåºã€‚\n* æ”¯æŒåˆ é™¤å›è°ƒå‡½æ•°ï¼Œé€šè¿‡kom.DefaultCluster().Callback().Delete(\"kom:get\")\n* æ”¯æŒæ›¿æ¢å›è°ƒå‡½æ•°ï¼Œé€šè¿‡kom.DefaultCluster().Callback().Replace(\"kom:get\",cb)\n```go\n// ä¸ºGetè·å–èµ„æºæ³¨å†Œå›è°ƒå‡½æ•°\nkom.DefaultCluster().Callback().Get().Register(\"get\", cb)\n// ä¸ºListè·å–èµ„æºæ³¨å†Œå›è°ƒå‡½æ•°\nkom.DefaultCluster().Callback().List().Register(\"list\", cb)\n// ä¸ºCreateåˆ›å»ºèµ„æºæ³¨å†Œå›è°ƒå‡½æ•°\nkom.DefaultCluster().Callback().Create().Register(\"create\", cb)\n// ä¸ºUpdateæ›´æ–°èµ„æºæ³¨å†Œå›è°ƒå‡½æ•°\nkom.DefaultCluster().Callback().Update().Register(\"update\", cb)\n// ä¸ºPatchæ›´æ–°èµ„æºæ³¨å†Œå›è°ƒå‡½æ•°\nkom.DefaultCluster().Callback().Patch().Register(\"patch\", cb)\n// ä¸ºDeleteåˆ é™¤èµ„æºæ³¨å†Œå›è°ƒå‡½æ•°\nkom.DefaultCluster().Callback().Delete().Register(\"delete\", cb)\n// ä¸ºWatchèµ„æºæ³¨å†Œå›è°ƒå‡½æ•°\nkom.DefaultCluster().Callback().Watch().Register(\"watch\",cb)\n// ä¸ºExec Podå†…æ‰§è¡Œå‘½ä»¤æ³¨å†Œå›è°ƒå‡½æ•°\nkom.DefaultCluster().Callback().Exec().Register(\"exec\", cb)\n// ä¸ºLogsè·å–æ—¥å¿—æ³¨å†Œå›è°ƒå‡½æ•°\nkom.DefaultCluster().Callback().Logs().Register(\"logs\", cb)\n// åˆ é™¤å›è°ƒå‡½æ•°\nkom.DefaultCluster().Callback().Get().Delete(\"get\")\n// æ›¿æ¢å›è°ƒå‡½æ•°\nkom.DefaultCluster().Callback().Get().Replace(\"get\", cb)\n// æŒ‡å®šå›è°ƒå‡½æ•°æ‰§è¡Œé¡ºåºï¼Œåœ¨å†…ç½®çš„å›è°ƒå‡½æ•°æ‰§è¡Œå®Œä¹‹åå†æ‰§è¡Œ\nkom.DefaultCluster().Callback().After(\"kom:get\").Register(\"get\", cb)\n// æŒ‡å®šå›è°ƒå‡½æ•°æ‰§è¡Œé¡ºåºï¼Œåœ¨å†…ç½®çš„å›è°ƒå‡½æ•°æ‰§è¡Œä¹‹å‰å…ˆæ‰§è¡Œ\n// æ¡ˆä¾‹1.åœ¨Createåˆ›å»ºèµ„æºå‰ï¼Œè¿›è¡Œæƒé™æ£€æŸ¥ï¼Œæ²¡æœ‰æƒé™åˆ™è¿”å›errorï¼Œåç»­åˆ›å»ºåŠ¨ä½œå°†ä¸å†æ‰§è¡Œ\n// æ¡ˆä¾‹2.åœ¨Listè·å–èµ„æºåˆ—è¡¨åï¼Œè¿›è¡Œç‰¹å®šçš„èµ„æºç­›é€‰ï¼Œä»åˆ—è¡¨(Statement.Dest)ä¸­åˆ é™¤ä¸ç¬¦åˆè¦æ±‚çš„èµ„æºï¼Œç„¶åè¿”å›ç»™ç”¨æˆ·\nkom.DefaultCluster().Callback().Before(\"kom:create\").Register(\"create\", cb)\n\n// è‡ªå®šä¹‰å›è°ƒå‡½æ•°\nfunc cb(k *kom.Kubectl) error {\n    stmt := k.Statement\n    gvr := stmt.GVR\n    ns := stmt.Namespace\n    name := stmt.Name\n    // æ‰“å°ä¿¡æ¯\n    fmt.Printf(\"Get %s/%s(%s)\\n\", ns, name, gvr)\n    fmt.Printf(\"Command %s/%s(%s %s)\\n\", ns, name, stmt.Command, stmt.Args)\n    return nil\n\t// return fmt.Errorf(\"error\") è¿”å›errorå°†é˜»æ­¢åç»­cbçš„æ‰§è¡Œ\n}\n```\n\n### 8. SQLæŸ¥è¯¢k8sèµ„æº\n* é€šè¿‡SQL()æ–¹æ³•æŸ¥è¯¢k8sèµ„æºï¼Œç®€å•é«˜æ•ˆã€‚\n* Table åç§°æ”¯æŒé›†ç¾¤å†…æ³¨å†Œçš„æ‰€æœ‰èµ„æºçš„å…¨ç§°åŠç®€å†™ï¼ŒåŒ…æ‹¬CRDèµ„æºã€‚åªè¦æ˜¯æ³¨å†Œåˆ°é›†ç¾¤ä¸Šäº†ï¼Œå°±å¯ä»¥æŸ¥ã€‚\n* å…¸å‹çš„Table åç§°æœ‰ï¼špod,deployment,service,ingress,pvc,pv,node,namespace,secret,configmap,serviceaccount,role,rolebinding,clusterrole,clusterrolebinding,crd,cr,hpa,daemonset,statefulset,job,cronjob,limitrange,horizontalpodautoscaler,poddisruptionbudget,networkpolicy,endpoints,ingressclass,mutatingwebhookconfiguration,validatingwebhookconfiguration,customresourcedefinition,storageclass,persistentvolumeclaim,persistentvolume,horizontalpodautoscaler,podsecurityã€‚ç»Ÿç»Ÿéƒ½å¯ä»¥æŸ¥ã€‚\n* æŸ¥è¯¢å­—æ®µç›®å‰ä»…æ”¯æŒ*ã€‚ä¹Ÿå°±æ˜¯select *\n* æŸ¥è¯¢æ¡ä»¶ç›®å‰æ”¯æŒ =ï¼Œ!=,>=,<=,<>,like,in,not in,and,or,between\n* æ’åºå­—æ®µç›®å‰æ”¯æŒå¯¹å•ä¸€å­—æ®µè¿›è¡Œæ’åºã€‚é»˜è®¤æŒ‰åˆ›å»ºæ—¶é—´å€’åºæ’åˆ—\n* \n#### æŸ¥è¯¢k8så†…ç½®èµ„æº\n```go\n    sql := \"select * from deploy where metadata.namespace='kube-system' or metadata.namespace='default' order by  metadata.creationTimestamp asc   \"\n\n\tvar list []v1.Deployment\n\terr := kom.DefaultCluster().Sql(sql).List(&list).Error\n\tfor _, d := range list {\n\t\tfmt.Printf(\"List Items foreach %s,%s at %s \\n\", d.GetNamespace(), d.GetName(), d.GetCreationTimestamp())\n\t}\n```\n#### æŸ¥è¯¢CRDèµ„æº\n```go\n    // vm ä¸ºkubevirt çš„CRD\n    sql := \"select * from vm where (metadata.namespace='kube-system' or metadata.namespace='default' )  \"\n\tvar list []unstructured.Unstructured\n\terr := kom.DefaultCluster().Sql(sql).List(&list).Error\n\tfor _, d := range list {\n\t\tfmt.Printf(\"List Items foreach %s,%s\\n\", d.GetNamespace(), d.GetName())\n\t}\n```\n#### é“¾å¼è°ƒç ”æŸ¥è¯¢SQL\n```go\n// æŸ¥è¯¢pod åˆ—è¡¨\nerr := kom.DefaultCluster().From(\"pod\").\n\t\tWhere(\"metadata.namespace = ?  or metadata.namespace= ? \", \"kube-system\", \"default\").\n\t\tOrder(\"metadata.creationTimestamp desc\").\n\t\tList(&list).Error\n```\n#### k8sèµ„æºåµŒå¥—åˆ—è¡¨å±æ€§æ”¯æŒ\n```go\n// spec.containersä¸ºåˆ—è¡¨ï¼Œå…¶ä¸‹çš„portsä¹Ÿä¸ºåˆ—è¡¨ï¼Œæˆ‘ä»¬æŸ¥è¯¢portsçš„name\nsql := \"select * from pod where spec.containers.ports.name like '%k8m%'  \"\nvar list []v1.Pod\nerr := kom.DefaultCluster().Sql(sql).List(&list).Error\nfor _, d := range list {\n\tt.Logf(\"List Items foreach %s,%s\\n\", d.GetNamespace(), d.GetName())\n}\n```\n\n### 9. å…¶ä»–æ“ä½œ\n#### Deploymenté‡å¯\n```go\nerr = kom.DefaultCluster().Resource(&Deployment{}).Namespace(\"default\").Name(\"nginx\").Ctl().Rollout().Restart()\n```\n#### Deploymentæ‰©ç¼©å®¹\n```go\n// å°†åç§°ä¸ºnginxçš„deploymentçš„å‰¯æœ¬æ•°è®¾ç½®ä¸º3\nerr = kom.DefaultCluster().Resource(&Deployment{}).Namespace(\"default\").Name(\"nginx\").Ctl().Scaler().Scale(3)\n```\n#### Deployment åœæ­¢\n```go\n// å°†åç§°ä¸ºnginxçš„deploymentçš„å‰¯æœ¬æ•°è®¾ç½®ä¸º0\n// å½“å‰è¿è¡Œå‰¯æœ¬æ•°é‡è®°å½•åˆ°æ³¨è§£ä¸­\nerr = kom.DefaultCluster().Resource(&Deployment{}).Namespace(\"default\").Name(\"nginx\").Ctl().Scaler().Stop()\n```\n#### Deployment æ¢å¤\n```go\n// å°†åç§°ä¸ºnginxçš„deploymentçš„å‰¯æœ¬æ•°ä»æ³¨è§£ä¸­æ¢å¤ï¼Œå¦‚æœæ²¡æœ‰æ³¨è§£ï¼Œé»˜è®¤æ¢å¤åˆ°1\nerr = kom.DefaultCluster().Resource(&Deployment{}).Namespace(\"default\").Name(\"nginx\").Ctl().Scaler().Restore()\n```\n#### Deploymentæ›´æ–°Tag\n```go\n// å°†åç§°ä¸ºnginxçš„deploymentçš„ä¸­çš„å®¹å™¨é•œåƒtagå‡çº§ä¸ºalpine\nerr = kom.DefaultCluster().Resource(&Deployment{}).Namespace(\"default\").Name(\"nginx\").Ctl().Deployment().ReplaceImageTag(\"main\",\"20241124\")\n```\n#### Deployment Rollout History\n```go\n// æŸ¥è¯¢åç§°ä¸ºnginxçš„deploymentçš„å‡çº§å†å²\nresult, err := kom.DefaultCluster().Resource(&Deployment{}).Namespace(\"default\").Name(\"nginx\").Ctl().Rollout().History()\n```\n#### Deployment Rollout Undo\n```go\n// å°†åç§°ä¸ºnginxçš„deploymentè¿›è¡Œå›æ»š\nresult, err := kom.DefaultCluster().Resource(&Deployment{}).Namespace(\"default\").Name(\"nginx\").Ctl().Rollout().Undo()\n// å°†åç§°ä¸ºnginxçš„deploymentè¿›è¡Œå›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬(history æŸ¥è¯¢)\nresult, err := kom.DefaultCluster().Resource(&Deployment{}).Namespace(\"default\").Name(\"nginx\").Ctl().Rollout().Undo(\"6\")\n```\n#### Deployment Rollout Pause\n```go\n// æš‚åœå‡çº§è¿‡ç¨‹\nerr := kom.DefaultCluster().Resource(&Deployment{}).Namespace(\"default\").Name(\"nginx\").Ctl().Rollout().Pause()\n```\n#### Deployment Rollout Resume \n```go\n// æ¢å¤å‡çº§è¿‡ç¨‹\nerr := kom.DefaultCluster().Resource(&Deployment{}).Namespace(\"default\").Name(\"nginx\").Ctl().Rollout().Resume()\n```\n#### Deployment Rollout Status \n```go\n// å°†åç§°ä¸ºnginxçš„deploymentçš„ä¸­çš„å®¹å™¨é•œåƒtagå‡çº§ä¸ºalpine\nresult, err := kom.DefaultCluster().Resource(&Deployment{}).Namespace(\"default\").Name(\"nginx\").Ctl().Rollout().Status()\n```\n#### Deployment HPA\n```go\n// æ˜¾ç¤ºdeploymentçš„hpa \nlist, err := kom.DefaultCluster().Resource(&v1.Deployment{}).Namespace(\"default\").Name(\"nginx-web\").Ctl().Deployment().HPAList()\nfor _, item := range list {\n    t.Logf(\"HPA %s\\n\", item.Name)\n}\n```\n#### èŠ‚ç‚¹æ‰“æ±¡ç‚¹\n```go\nerr = kom.DefaultCluster().Resource(&Node{}).Name(\"kind-control-plane\").Ctl().Node().Taint(\"dedicated=special-user:NoSchedule\")\n```\n#### èŠ‚ç‚¹å»é™¤æ±¡ç‚¹\n```go\nerr = kom.DefaultCluster().Resource(&Node{}).Name(\"kind-control-plane\").Ctl().Node().UnTaint(\"dedicated=special-user:NoSchedule\")\n```\n#### èŠ‚ç‚¹Cordon\n```go\nerr = kom.DefaultCluster().Resource(&Node{}).Name(\"kind-control-plane\").Ctl().Node().Cordon()\n```\n#### èŠ‚ç‚¹UnCordon\n```go\nerr = kom.DefaultCluster().Resource(&Node{}).Name(\"kind-control-plane\").Ctl().Node().UnCordon()\n```\n#### èŠ‚ç‚¹Drain\n```go\nerr = kom.DefaultCluster().Resource(&Node{}).Name(\"kind-control-plane\").Ctl().Node().Drain()\n```\n#### æŸ¥è¯¢èŠ‚ç‚¹IPèµ„æºæƒ…å†µ\næ”¯æŒè®¾ç½®ç¼“å­˜æ—¶é—´ï¼Œé¿å…é¢‘ç¹æŸ¥è¯¢k8s API\n```go\nnodeName := \"lima-rancher-desktop\"\ntotal, used, available := kom.DefaultCluster().Resource(&corev1.Node{}).WithCache(5 * time.Second).Name(nodeName).Ctl().Node().IPUsage()\nfmt.Printf(\"Total %d, Used %d, Available %d\\n\", total, used, available)\n//Total 256, Used 6, Available 250\n```\n#### èŠ‚ç‚¹IPèµ„æºä½¿ç”¨æƒ…å†µç»Ÿè®¡\næ”¯æŒè®¾ç½®ç¼“å­˜æ—¶é—´ï¼Œé¿å…é¢‘ç¹æŸ¥è¯¢k8s API\n```go\nnodeName := \"lima-rancher-desktop\"\ntotal, used, available := kom.DefaultCluster().Resource(&corev1.Node{}).WithCache(5 * time.Second).Name(nodeName).Ctl().Node().PodCount()\nfmt.Printf(\"Total %d, Used %d, Available %d\\n\", total, used, available)\n//Total 110, Used 9, Available 101\n```\n#### èŠ‚ç‚¹èµ„æºç”¨é‡æƒ…å†µç»Ÿè®¡\næ”¯æŒè®¾ç½®ç¼“å­˜æ—¶é—´ï¼Œé¿å…é¢‘ç¹æŸ¥è¯¢k8s API\n```go\nnodeName := \"lima-rancher-desktop\"\nusage := kom.DefaultCluster().Resource(&corev1.Node{}).WithCache(5 * time.Second).Name(nodeName).Ctl().Node().ResourceUsage()\nfmt.Printf(\"Node Usage %s\\n\", utils.ToJSON(usage))\n```\nåŒ…æ‹¬å½“å‰çš„è¯·æ±‚å€¼ã€é™åˆ¶å€¼ã€å¯åˆ†é…å€¼ã€ä½¿ç”¨æ¯”ä¾‹\n```json\n{\n  \"requests\": {\n    \"cpu\": \"200m\",\n    \"memory\": \"140Mi\"\n  },\n  \"limits\": {\n    \"memory\": \"170Mi\"\n  },\n  \"allocatable\": {\n    \"cpu\": \"4\",\n    \"ephemeral-storage\": \"99833802265\",\n    \"hugepages-1Gi\": \"0\",\n    \"hugepages-2Mi\": \"0\",\n    \"hugepages-32Mi\": \"0\",\n    \"hugepages-64Ki\": \"0\",\n    \"memory\": \"8127096Ki\",\n    \"pods\": \"110\"\n  },\n  \"usageFractions\": {\n    \"cpu\": {\n      \"requestFraction\": 5,\n      \"limitFraction\": 0\n    },\n    \"ephemeral-storage\": {\n      \"requestFraction\": 0,\n      \"limitFraction\": 0\n    },\n    \"memory\": {\n      \"requestFraction\": 1.76397571777176,\n      \"limitFraction\": 2.1419705144371375\n    }\n  }\n}\n```\n#### ç»™èµ„æºå¢åŠ æ ‡ç­¾\n```go\nerr = kom.DefaultCluster().Resource(&Node{}).Name(\"kind-control-plane\").Ctl().Label(\"name=zhangsan\")\n```\n#### ç»™èµ„æºåˆ é™¤æ ‡ç­¾\n```go\nerr = kom.DefaultCluster().Resource(&Node{}).Name(\"kind-control-plane\").Ctl().Label(\"name-\")\n```\n#### ç»™èµ„æºå¢åŠ æ³¨è§£\n```go\nerr = kom.DefaultCluster().Resource(&Node{}).Name(\"kind-control-plane\").Ctl().Annotate(\"name=zhangsan\")\n```\n#### ç»™èµ„æºåˆ é™¤æ³¨è§£\n```go\nerr = kom.DefaultCluster().Resource(&Node{}).Name(\"kind-control-plane\").Ctl().Annotate(\"name-\")\n```\n#### åˆ›å»ºNodeSell\n```go\nns, pod, container, err  := kom.DefaultCluster().Resource(&v1.Node{}).Name(\"kind-control-plane\").Ctl().Node().CreateNodeShell()\nfmt.Printf(\"Node Shell ns=%s podName=%s containerName=%s\", ns, pod, container)\n```\n#### åˆ›å»ºkubectl Shell\n```go\nns, pod, container, err := kom.DefaultCluster().Resource(&v1.Node{}).Name(name).Ctl().Node().CreateKubectlShell(kubeconfig)\nfmt.Printf(\"Kubectl Shell ns=%s podName=%s containerName=%s\", ns, pod, container)\n\n```\n#### ç»Ÿè®¡StorageClassä¸‹çš„PVCæ•°é‡\n```go\ncount, err := kom.DefaultCluster().Resource(&v1.StorageClass{}).Name(\"hostpath\").Ctl().StorageClass().PVCCount()\nfmt.Printf(\"pvc count %d\\n\", count)\n```\n#### ç»Ÿè®¡StorageClassä¸‹çš„PVæ•°é‡\n```go\ncount, err := kom.DefaultCluster().Resource(&v1.StorageClass{}).Name(\"hostpath\").Ctl().StorageClass().PVCount()\nfmt.Printf(\"pv count %d\\n\", count)\n```\n#### è®¾ç½®StorageClassä¸ºé»˜è®¤\n```go\nerr := kom.DefaultCluster().Resource(&v1.StorageClass{}).Name(\"hostpath\").Ctl().StorageClass().SetDefault()\n```\n#### è®¾ç½®IngressClassä¸ºé»˜è®¤\n```go\nerr := kom.DefaultCluster().Resource(&v1.IngressClass{}).Name(\"nginx\").Ctl().IngressClass().SetDefault()\n```\n#### ç»Ÿè®¡Deployment/StatefulSet/DaemonSetä¸‹çš„Podåˆ—è¡¨\n```go\nlist, err := kom.DefaultCluster().Namespace(\"default\").Name(\"managed-pods\").Ctl().Deployment().ManagedPods()\nfor _, pod := range list {\n\tfmt.Printf(\"ManagedPod: %v\", pod.Name)\n}\n```\n#### è·å–æ‰€æœ‰èŠ‚ç‚¹çš„æ ‡ç­¾é›†åˆ\n```go\n// labels ç±»å‹ä¸ºmap[string]string\nlabels, err := kom.DefaultCluster().Resource(&v1.Node{}).Ctl().Node().AllNodeLabels()\nfmt.Printf(\"%s\", utils.ToJSON(labels))\n```\n```json\n{\n          \"beta.kubernetes.io/arch\": \"arm64\",\n          \"beta.kubernetes.io/os\": \"linux\",\n          \"kubernetes.io/arch\": \"arm64\",\n          \"kubernetes.io/hostname\": \"kind-control-plane\",\n          \"kubernetes.io/os\": \"linux\",\n          \"kubernetes.io/role\": \"agent\",\n          \"node-role.kubernetes.io/agent\": \"\",\n          \"node-role.kubernetes.io/control-plane\": \"\",\n          \"type\": \"kwok\",\n          \"uat\": \"test\",\n          \"x\": \"x\"\n}\n```\n#### æŸ¥çœ‹Podèµ„æºå ç”¨ç‡\n```go\npodName := \"coredns-ccb96694c-jprpf\"\nns := \"kube-system\"\nusage := kom.DefaultCluster().Resource(&corev1.Pod{}).Name(podName).Namespace(ns).Ctl().Pod().ResourceUsage()\nfmt.Printf(\"Pod Usage %s\\n\", utils.ToJSON(usage))\n```\nåŒ…æ‹¬å½“å‰çš„è¯·æ±‚å€¼ã€é™åˆ¶å€¼ã€å¯åˆ†é…å€¼ã€ä½¿ç”¨æ¯”ä¾‹\n```json\n{\n  \"requests\": {\n    \"cpu\": \"100m\",\n    \"memory\": \"70Mi\"\n  },\n  \"limits\": {\n    \"memory\": \"170Mi\"\n  },\n  \"allocatable\": {\n    \"cpu\": \"4\",\n    \"ephemeral-storage\": \"99833802265\",\n    \"hugepages-1Gi\": \"0\",\n    \"hugepages-2Mi\": \"0\",\n    \"hugepages-32Mi\": \"0\",\n    \"hugepages-64Ki\": \"0\",\n    \"memory\": \"8127096Ki\",\n    \"pods\": \"110\"\n  },\n  \"usageFractions\": {\n    \"cpu\": {\n      \"requestFraction\": 2.5,\n      \"limitFraction\": 0\n    },\n    \"memory\": {\n      \"requestFraction\": 0.88198785888588,\n      \"limitFraction\": 2.1419705144371375\n    }\n  }\n}\n```\n#### è·å–å­—æ®µæ–‡æ¡£è§£é‡Š\n```go\nvar docResult []byte\n\titem := v1.Deployment{}\n\tfield := \"spec.replicas\"\n\tfield = \"spec.template.spec.containers.name\"\n\tfield = \"spec.template.spec.containers.imagePullPolicy\"\n\tfield = \"spec.template.spec.containers.livenessProbe.successThreshold\"\n\terr := kom.DefaultCluster().\n\t\tResource(&item).DocField(field).Doc(&docResult).Error\n\tfmt.Printf(\"Get Deployment Doc [%s] :%s\", field, string(docResult))\n```\n## è”ç³»æˆ‘\n\nå¾®ä¿¡ï¼ˆå¤§ç½—é©¬çš„å¤ªé˜³ï¼‰ æœç´¢IDï¼šdaluomadetaiyang,å¤‡æ³¨komã€‚\n<br><img width=\"214\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/166db141-42c5-42c4-9964-8e25cf12d04c\" />\n\n## å¾®ä¿¡ç¾¤\n\n\n![è¾“å…¥å›¾ç‰‡è¯´æ˜](https://foruda.gitee.com/images/1750260119732715094/a1ed9e5b_77493.png \"å±å¹•æˆªå›¾\")\n\n"
}